<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mason's Ultimate Multi Purpose Tool - Enhanced Space Edition</title>
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiTWFzb24ncyBUb29sIiwic2hvcnRfbmFtZSI6Ik1hc29uVG9vbCIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMDAwIiwidGhlbWVfY29sb3IiOiIjNGZjM2Y3In0=">
<style>
  /* Enhanced Reset & Base */
  * {
    box-sizing: border-box;
  }
  
  :root {
    --primary: #4fc3f7;
    --primary-dark: #0288d1;
    --secondary: #81d4fa;
    --accent: #b3e5fc;
    --bg-dark: #000;
    --bg-card: #121212;
    --bg-hover: #1a1a1a;
    --text-primary: #eee;
    --text-secondary: #bbb;
    --border: #333;
    --border-focus: #4fc3f7;
    --success: #4caf50;
    --warning: #ff9800;
    --error: #f44336;
    --glass-bg: rgba(18, 18, 18, 0.8);
    --glass-border: rgba(255, 255, 255, 0.1);
    --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    --glow: 0 0 20px rgba(79, 195, 247, 0.3);
  }

  body, html {
    margin:0; padding:0;
    background: var(--bg-dark);
    color: var(--text-primary);
    font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
    overflow-x: hidden;
    min-height: 100vh;
    user-select: none;
    font-size: clamp(14px, 1.5vw, 16px);
  }

  /* Enhanced Header */
  header {
    background: rgba(17, 17, 17, 0.95);
    backdrop-filter: blur(20px);
    padding: 16px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--glass-border);
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: var(--shadow);
  }
  
  header .title {
    font-weight: 900;
    font-size: clamp(1.2rem, 3vw, 1.8rem);
    letter-spacing: 2px;
    color: var(--text-primary);
    text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
    background: linear-gradient(45deg, #4fc3f7, #81d4fa);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .header-controls {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  /* Enhanced Buttons */
  button, .btn {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    color: var(--text-primary);
    padding: 12px 20px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    user-select: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }
  
  button:hover, .btn:hover {
    background: var(--bg-hover);
    border-color: var(--primary);
    box-shadow: var(--glow);
    transform: translateY(-2px);
  }
  
  button:active, .btn:active {
    transform: translateY(0);
  }
  
  button:disabled {
    background: #111;
    cursor: not-allowed;
    color: #666;
    border-color: #222;
  }

  /* Ripple Effect */
  .ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(79, 195, 247, 0.6);
    transform: scale(0);
    animation: ripple 0.6s linear;
    pointer-events: none;
  }
  
  @keyframes ripple {
    to {
      transform: scale(4);
      opacity: 0;
    }
  }

  /* Command Palette */
  .command-palette {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    width: 90%;
    max-width: 600px;
    max-height: 80vh;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  }
  
  .command-palette.active {
    opacity: 1;
    visibility: visible;
    transform: translate(-50%, -50%) scale(1);
  }
  
  .command-palette input {
    width: 100%;
    padding: 20px 24px;
    background: transparent;
    border: none;
    color: var(--text-primary);
    font-size: 1.1rem;
    outline: none;
    border-bottom: 1px solid var(--glass-border);
  }
  
  .command-results {
    max-height: 400px;
    overflow-y: auto;
    padding: 12px;
  }
  
  .command-item {
    padding: 12px 16px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.2s;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .command-item:hover, .command-item.selected {
    background: var(--bg-hover);
  }
  
  .command-shortcut {
    margin-left: auto;
    color: var(--text-secondary);
    font-size: 0.8rem;
    background: rgba(255, 255, 255, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
  }

  /* Enhanced Main Grid */
  main {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 24px;
    padding: 32px 24px;
    max-width: 1400px;
    margin: 0 auto 40px;
  }

  /* Enhanced Cards with Glassmorphism */
  section.card {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 24px 28px;
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  section.card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4), var(--glow);
    border-color: var(--primary);
  }
  
  section.card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--primary), transparent);
    opacity: 0;
    transition: opacity 0.3s;
  }
  
  section.card:hover::before {
    opacity: 1;
  }
  
  section.card h2 {
    margin: 0 0 20px;
    font-weight: 700;
    font-size: 1.4rem;
    color: var(--text-primary);
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .card-icon {
    font-size: 1.2rem;
    opacity: 0.8;
  }
  
  .card-favorite {
    margin-left: auto;
    cursor: pointer;
    font-size: 1.1rem;
    opacity: 0.5;
    transition: all 0.3s;
  }
  
  .card-favorite:hover {
    opacity: 1;
    transform: scale(1.2);
  }
  
  .card-favorite.active {
    opacity: 1;
    color: var(--warning);
  }

  /* Enhanced Form Elements */
  textarea, input[type=text], input[type=number], input[type=password], select, pre, .output {
    background: rgba(27, 27, 27, 0.8);
    backdrop-filter: blur(10px);
    color: var(--text-primary);
    border: 1px solid var(--border);
    border-radius: 12px;
    font-family: 'JetBrains Mono', 'Fira Code', monospace;
    font-size: 1rem;
    padding: 14px 16px;
    resize: vertical;
    min-height: 48px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    width: 100%;
  }
  
  textarea:focus, input:focus, select:focus {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px rgba(79, 195, 247, 0.2), var(--glow);
    transform: translateY(-1px);
  }
  
  pre, .output {
    white-space: pre-wrap;
    word-break: break-word;
    min-height: 100px;
    font-family: 'JetBrains Mono', monospace;
    line-height: 1.5;
  }

  /* Floating Action Button */
  .fab {
    position: fixed;
    bottom: 24px;
    right: 24px;
    width: 64px;
    height: 64px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    border: none;
    box-shadow: var(--shadow), var(--glow);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 50;
  }
  
  .fab:hover {
    transform: scale(1.1) translateY(-2px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4), 0 0 30px rgba(79, 195, 247, 0.5);
  }

  /* Enhanced Calculator */
  .calc-buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-top: 16px;
  }
  
  .calc-buttons button {
    margin-top: 0;
    font-size: 1.2rem;
    font-weight: 700;
    padding: 18px 0;
    border-radius: 16px;
    transition: all 0.2s;
  }
  
  .calc-buttons button:hover {
    background: var(--primary);
    color: white;
  }
  
  .calc-buttons button:active {
    transform: scale(0.95);
  }

  /* Enhanced Password Generator */
  .pw-controls {
    display: flex;
    gap: 12px;
    align-items: center;
    flex-wrap: wrap;
  }
  
  .pw-controls input[type=number] {
    width: 100px;
  }
  
  .pw-output {
    margin-top: 16px;
    font-family: 'JetBrains Mono', monospace;
    font-weight: 700;
    font-size: 1.1rem;
    padding: 16px;
    background: rgba(34, 34, 34, 0.8);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border);
    border-radius: 12px;
    user-select: text;
    cursor: pointer;
    transition: all 0.3s;
    word-break: break-all;
  }
  
  .pw-output:hover {
    border-color: var(--primary);
    box-shadow: var(--glow);
  }

  /* Enhanced Task List */
  #task-list {
    margin-top: 16px;
    max-height: 300px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--primary) transparent;
  }
  
  #task-list::-webkit-scrollbar {
    width: 6px;
  }
  
  #task-list::-webkit-scrollbar-track {
    background: transparent;
  }
  
  #task-list::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 3px;
  }
  
  #task-list li {
    list-style: none;
    padding: 16px 18px;
    border-bottom: 1px solid var(--glass-border);
    cursor: pointer;
    transition: all 0.3s;
    border-radius: 12px;
    margin-bottom: 8px;
    background: rgba(255, 255, 255, 0.02);
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  #task-list li:hover {
    background: var(--bg-hover);
    transform: translateX(4px);
  }
  
  #task-list li.completed {
    text-decoration: line-through;
    color: var(--text-secondary);
    opacity: 0.6;
  }
  
  #task-list li::before {
    content: '○';
    font-size: 1.2rem;
    color: var(--primary);
    transition: all 0.3s;
  }
  
  #task-list li.completed::before {
    content: '●';
    color: var(--success);
  }

  /* Status Indicators */
  .status {
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 0.9rem;
    margin-top: 12px;
    border-left: 4px solid;
    backdrop-filter: blur(10px);
  }
  
  .status.success {
    background: rgba(76, 175, 80, 0.1);
    border-color: var(--success);
    color: var(--success);
  }
  
  .status.warning {
    background: rgba(255, 152, 0, 0.1);
    border-color: var(--warning);
    color: var(--warning);
  }
  
  .status.error {
    background: rgba(244, 67, 54, 0.1);
    border-color: var(--error);
    color: var(--error);
  }

  /* Loading States */
  .loading {
    position: relative;
    pointer-events: none;
  }
  
  .loading::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(2px);
    border-radius: inherit;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .spinner {
    width: 32px;
    height: 32px;
    border: 3px solid rgba(79, 195, 247, 0.3);
    border-top: 3px solid var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Notification Toast */
  .toast {
    position: fixed;
    top: 100px;
    right: 24px;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 16px 20px;
    box-shadow: var(--shadow);
    z-index: 1000;
    transform: translateX(400px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    max-width: 350px;
  }
  
  .toast.show {
    transform: translateX(0);
  }
  
  .toast.success {
    border-left: 4px solid var(--success);
  }
  
  .toast.error {
    border-left: 4px solid var(--error);
  }
  
  .toast.warning {
    border-left: 4px solid var(--warning);
  }

  /* Enhanced Footer */
  footer {
    text-align: center;
    padding: 24px;
    background: rgba(17, 17, 17, 0.95);
    backdrop-filter: blur(20px);
    border-top: 1px solid var(--glass-border);
    font-size: 0.9rem;
    color: var(--text-secondary);
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
  }

  /* Canvas (Your Beautiful Space Background - UNCHANGED!) */
  #stars-canvas, #spaceship-canvas, #trail-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    z-index: 0;
  }

  /* Tool container higher z-index */
  main, header, footer {
    position: relative;
    z-index: 5;
  }

  /* Dark Mode Toggle Enhancement */
  .theme-selector {
    display: flex;
    gap: 8px;
    background: rgba(255, 255, 255, 0.1);
    padding: 4px;
    border-radius: 12px;
    backdrop-filter: blur(10px);
  }
  
  .theme-btn {
    padding: 8px 12px;
    border: none;
    background: transparent;
    color: var(--text-secondary);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 0.8rem;
  }
  
  .theme-btn.active {
    background: var(--primary);
    color: white;
  }

  /* Keyboard Shortcuts Help */
  .shortcuts-help {
    position: fixed;
    bottom: 80px;
    right: 24px;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 20px;
    max-width: 300px;
    z-index: 50;
    transform: translateY(20px);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s;
  }
  
  .shortcuts-help.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  .shortcut-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 0.9rem;
  }
  
  .shortcut-key {
    background: rgba(255, 255, 255, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
    font-family: monospace;
  }

  /* Mobile Responsive Enhancements */
  @media (max-width: 768px) {
    main {
      grid-template-columns: 1fr;
      padding: 20px 16px;
      gap: 20px;
    }
    
    header {
      padding: 12px 16px;
    }
    
    .header-controls {
      gap: 8px;
    }
    
    button, .btn {
      padding: 10px 16px;
      font-size: 0.8rem;
    }
    
    section.card {
      padding: 20px;
    }
    
    .fab {
      bottom: 16px;
      right: 16px;
      width: 56px;
      height: 56px;
    }
    
    .command-palette {
      width: 95%;
      margin: 0 2.5%;
    }
  }
  
  /* New Tools Specific Styles */
  .qr-output {
    text-align: center;
    margin-top: 16px;
  }
  
  .qr-output canvas {
    border: 8px solid var(--glass-bg);
    border-radius: 12px;
    background: white;
    padding: 8px;
  }
  
  .color-palette {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
    gap: 12px;
    margin-top: 16px;
  }
  
  .color-swatch {
    height: 60px;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    border: 2px solid transparent;
  }
  
  .color-swatch:hover {
    transform: scale(1.1);
    border-color: var(--primary);
  }
  
  .unit-converter {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 12px;
    align-items: end;
  }
  
  .timezone-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
    margin-top: 16px;
  }
  
  .timezone-card {
    background: rgba(255, 255, 255, 0.05);
    padding: 16px;
    border-radius: 12px;
    text-align: center;
    border: 1px solid var(--glass-border);
  }
  
  .time-display {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 8px;
    font-family: 'JetBrains Mono', monospace;
  }
  
  .json-formatter {
    position: relative;
  }
  
  .json-formatter .format-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    padding: 4px 8px;
    font-size: 0.8rem;
  }
  
  .regex-tester {
    display: grid;
    gap: 12px;
  }
  
  .regex-matches {
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid var(--success);
    border-radius: 8px;
    padding: 12px;
    margin-top: 8px;
    min-height: 40px;
  }
  
  .match-item {
    background: rgba(79, 195, 247, 0.2);
    padding: 4px 8px;
    border-radius: 4px;
    margin: 4px;
    display: inline-block;
    font-family: monospace;
  }
  
  /* Crypto Price Ticker */
  .crypto-ticker {
    display: flex;
    gap: 16px;
    overflow-x: auto;
    padding: 16px 0;
    scrollbar-width: none;
  }
  
  .crypto-ticker::-webkit-scrollbar {
    display: none;
  }
  
  .crypto-item {
    min-width: 120px;
    text-align: center;
    background: rgba(255, 255, 255, 0.05);
    padding: 12px;
    border-radius: 8px;
    border: 1px solid var(--glass-border);
  }
  
  .crypto-symbol {
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 4px;
  }
  
  .crypto-price {
    font-size: 0.9rem;
    color: var(--text-primary);
  }
  
  .price-change {
    font-size: 0.8rem;
    margin-top: 4px;
  }
  
  .price-change.positive {
    color: var(--success);
  }
  
  .price-change.negative {
    color: var(--error);
  }

  /* Performance Monitor */
  .perf-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 12px;
    margin-top: 16px;
  }
  
  .perf-stat {
    background: rgba(255, 255, 255, 0.05);
    padding: 12px;
    border-radius: 8px;
    text-align: center;
    border: 1px solid var(--glass-border);
  }
  
  .perf-value {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 4px;
  }
  
  .perf-label {
    font-size: 0.8rem;
    color: var(--text-secondary);
  }

  /* Focus States for Accessibility */
  *:focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
  }
  
  /* Reduced Motion */
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
  
  /* High Contrast Mode */
  @media (prefers-contrast: high) {
    :root {
      --bg-card: #222;
      --border: #666;
      --text-primary: #fff;
    }
  }
</style>
</head>
<body>

<!-- Loading Screen -->
<div id="loader" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#000;display:flex;align-items:center;justify-content:center;z-index:99999;">
  <div style="text-align:center;">
    <div class="spinner" style="margin:0 auto 20px;"></div>
    <div style="color:#4fc3f7;font-size:1.2rem;font-weight:600;">Loading Mason's Ultimate Tool...</div>
  </div>
</div>

<!-- Your Beautiful Space Background (UNCHANGED!) -->
<canvas id="stars-canvas"></canvas>
<canvas id="spaceship-canvas"></canvas>
<canvas id="trail-canvas"></canvas>

<!-- Command Palette -->
<div class="command-palette" id="command-palette">
  <input type="text" placeholder="Search tools... (Ctrl+K)" id="command-input">
  <div class="command-results" id="command-results"></div>
</div>

<!-- Overlay for Command Palette -->
<div id="overlay" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:999;opacity:0;visibility:hidden;transition:all 0.3s;"></div>

<header>
  <div class="title">🚀 Mason's Ultimate Tool</div>
  <div class="header-controls">
    <button id="select-file" title="Select Music/Video">🎵 Media</button>
    <input type="file" id="file-input" accept="audio/*,video/*" hidden />
    <div class="theme-selector">
      <button class="theme-btn active" data-theme="dark">🌙</button>
      <button class="theme-btn" data-theme="space">🌌</button>
      <button class="theme-btn" data-theme="neon">⚡</button>
    </div>
    <button id="help-btn" title="Keyboard Shortcuts (?)">❓</button>
  </div>
</header>

<main>
  <!-- Enhanced Notes with Auto-save -->
  <section class="card" data-tool="notes">
    <h2><span class="card-icon">📝</span>Smart Notes<span class="card-favorite" data-tool="notes">⭐</span></h2>
    <textarea id="notes" placeholder="Start typing... Auto-saves every 3 seconds"></textarea>
    <div style="display:flex;gap:8px;margin-top:12px;">
      <button id="save-notes">💾 Save</button>
      <button id="export-notes">📤 Export</button>
      <button id="import-notes">📥 Import</button>
    </div>
    <div id="notes-status" class="status" style="display:none;"></div>
  </section>

  <!-- Enhanced Word Counter -->
  <section class="card" data-tool="word-counter">
    <h2><span class="card-icon">📊</span>Text Analytics<span class="card-favorite" data-tool="word-counter">⭐</span></h2>
    <textarea id="word-input" placeholder="Paste or type text here for detailed analysis..."></textarea>
    <button id="count-btn">📈 Analyze Text</button>
    <div id="word-stats" style="margin-top:12px;display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:8px;"></div>
  </section>

  <!-- Enhanced Base64 with Multiple Encodings -->
  <section class="card" data-tool="base64">
    <h2><span class="card-icon">🔐</span>Text Encoder<span class="card-favorite" data-tool="base64">⭐</span></h2>
    <textarea id="b64-input" placeholder="Enter text to encode/decode..."></textarea>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;">
      <button id="b64-encode">🔒 Base64 Encode</button>
      <button id="b64-decode">🔓 Base64 Decode</button>
      <button id="url-encode">🌐 URL Encode</button>
      <button id="url-decode">🔗 URL Decode</button>
    </div>
    <div class="output" id="b64-output" style="margin-top:12px;"></div>
    <button id="b64-copy" style="margin-top:8px;">📋 Copy Result</button>
  </section>

  <!-- QR Code Generator -->
  <section class="card" data-tool="qr-code">
    <h2><span class="card-icon">📱</span>QR Code Generator<span class="card-favorite" data-tool="qr-code">⭐</span></h2>
    <input type="text" id="qr-input" placeholder="Enter text or URL...">
    <div style="display:flex;gap:8px;margin-top:12px;">
      <button id="qr-generate">🔳 Generate QR</button>
      <button id="qr-download">⬇️ Download</button>
    </div>
    <div class="qr-output" id="qr-output"></div>
  </section>

  <!-- Color Palette Generator -->
  <section class="card" data-tool="color-picker">
    <h2><span class="card-icon">🎨</span>Color Palette<span class="card-favorite" data-tool="color-picker">⭐</span></h2>
    <input type="color" id="base-color" value="#4fc3f7" style="width:100%;height:50px;border:none;border-radius:8px;cursor:pointer;">
    <div style="display:flex;gap:8px;margin-top:12px;">
      <button id="generate-palette">🌈 Generate Palette</button>
      <button id="random-palette">🎲 Random</button>
    </div>
    <div class="color-palette" id="color-palette"></div>
    <div id="color-codes" style="margin-top:12px;font-family:monospace;font-size:0.9rem;"></div>
  </section>

  <!-- Enhanced Browser Info -->
  <section class="card" data-tool="browser-info">
    <h2><span class="card-icon">🌐</span>Browser Info<span class="card-favorite" data-tool="browser-info">⭐</span></h2>
    <button id="show-info">🔍 Show Browser Info</button>
    <pre id="browser-info" style="margin-top:12px;"></pre>
  </section>

  <!-- Enhanced System Info -->
  <section class="card" data-tool="system-info">
    <h2><span class="card-icon">💻</span>System Info<span class="card-favorite" data-tool="system-info">⭐</span></h2>
    <button id="show-system-info">📊 Show System Info</button>
    <pre id="system-info" style="margin-top:12px;"></pre>
  </section>

  <!-- Performance Monitor -->
  <section class="card" data-tool="performance">
    <h2><span class="card-icon">⚡</span>Performance Monitor<span class="card-favorite" data-tool="performance">⭐</span></h2>
    <button id="perf-monitor">📈 Monitor Performance</button>
    <div class="perf-stats" id="perf-stats"></div>
  </section>

  <!-- Enhanced Device Info -->
  <section class="card" data-tool="device-info">
    <h2><span class="card-icon">📱</span>Device Info<span class="card-favorite" data-tool="device-info">⭐</span></h2>
    <button id="show-device-info">🔋 Show Device Info</button>
    <pre id="device-info" style="margin-top:12px;"></pre>
  </section>

  <!-- Enhanced Weather -->
  <section class="card" data-tool="weather">
    <h2><span class="card-icon">🌤️</span>Weather<span class="card-favorite" data-tool="weather">⭐</span></h2>
    <div style="display:flex;gap:8px;">
      <input id="weather-city" type="text" placeholder="City name..." style="flex:1;">
      <button id="get-weather">🌍 Get Weather</button>
      <button id="get-location-weather">📍 Use Location</button>
    </div>
    <div id="weather-output" style="margin-top:12px;"></div>
  </section>

  <!-- Enhanced Quotes -->
  <section class="card" data-tool="quotes">
    <h2><span class="card-icon">💭</span>Inspiration<span class="card-favorite" data-tool="quotes">⭐</span></h2>
    <div id="quote-text" style="font-style: italic;margin-bottom:12px;">Click for daily inspiration...</div>
    <div style="display:flex;gap:8px;">
      <button id="new-quote">✨ New Quote</button>
      <button id="save-quote">💾 Save Quote</button>
      <button id="share-quote">📤 Share</button>
    </div>
    <div id="saved-quotes" style="margin-top:12px;"></div>
  </section>

  <!-- Enhanced Pomodoro Timer -->
  <section class="card" data-tool="pomodoro">
    <h2><span class="card-icon">🍅</span>Pomodoro Timer<span class="card-favorite" data-tool="pomodoro">⭐</span></h2>
    <div id="pomodoro-display" style="font-size: 2rem; font-weight: 700; text-align:center; margin: 20px 0; color: var(--primary);">25:00</div>
    <div style="display:flex;gap:8px;justify-content:center;margin-bottom:12px;">
      <button id="pomodoro-start">▶️ Start</button>
      <button id="pomodoro-pause" disabled>⏸️ Pause</button>
      <button id="pomodoro-reset">🔄 Reset</button>
    </div>
    <div style="display:flex;gap:8px;font-size:0.9rem;">
      <label style="flex:1;">Work: <input type="number" id="work-time" value="25" min="1" max="60" style="width:60px;"></label>
      <label style="flex:1;">Break: <input type="number" id="break-time" value="5" min="1" max="30" style="width:60px;"></label>
    </div>
    <div id="pomo-stats" style="margin-top:12px;font-size:0.9rem;color:var(--text-secondary);"></div>
  </section>

  <!-- Enhanced Calculator -->
  <section class="card" data-tool="calculator">
    <h2><span class="card-icon">🧮</span>Calculator<span class="card-favorite" data-tool="calculator">⭐</span></h2>
    <input id="calc-display" readonly value="0" style="text-align:right;font-size:1.5rem;font-weight:700;" />
    <div class="calc-buttons">
      <button data-val="C" style="background:var(--error);">C</button>
      <button data-val="±">±</button>
      <button data-val="%">%</button>
      <button data-val="/" style="background:var(--primary);">÷</button>
      <button data-val="7">7</button>
      <button data-val="8">8</button>
      <button data-val="9">9</button>
      <button data-val="*" style="background:var(--primary);">×</button>
      <button data-val="4">4</button>
      <button data-val="5">5</button>
      <button data-val="6">6</button>
      <button data-val="-" style="background:var(--primary);">−</button>
      <button data-val="1">1</button>
      <button data-val="2">2</button>
      <button data-val="3">3</button>
      <button data-val="+" style="background:var(--primary);">+</button>
      <button data-val="0" style="grid-column:span 2;">0</button>
      <button data-val=".">.</button>
      <button id="calc-equal" style="background:var(--success);">=</button>
    </div>
    <div id="calc-history" style="margin-top:12px;max-height:100px;overflow-y:auto;font-size:0.8rem;color:var(--text-secondary);"></div>
  </section>

  <!-- Enhanced Currency Converter -->
  <section class="card" data-tool="currency">
    <h2><span class="card-icon">💱</span>Currency Converter<span class="card-favorite" data-tool="currency">⭐</span></h2>
    <div style="display:grid;grid-template-columns:1fr auto 1fr;gap:12px;align-items:end;">
      <div>
        <label>From:</label>
        <select id="from-currency"></select>
        <input type="number" id="amount" min="0" value="1" placeholder="Amount">
      </div>
      <button id="swap-currencies" style="width:40px;height:40px;border-radius:50%;font-size:1.2rem;" title="Swap currencies">🔄</button>
      <div>
        <label>To:</label>
        <select id="to-currency"></select>
        <div id="converted-amount" style="font-size:1.2rem;font-weight:700;color:var(--primary);margin-top:8px;">-</div>
      </div>
    </div>
    <button id="convert-btn" style="margin-top:12px;width:100%;">💹 Convert</button>
    <div id="currency-result" style="margin-top:12px;"></div>
    <div id="exchange-rate" style="margin-top:8px;font-size:0.9rem;color:var(--text-secondary);"></div>
  </section>

  <!-- Cryptocurrency Tracker -->
  <section class="card" data-tool="crypto">
    <h2><span class="card-icon">₿</span>Crypto Tracker<span class="card-favorite" data-tool="crypto">⭐</span></h2>
    <button id="refresh-crypto">🔄 Refresh Prices</button>
    <div class="crypto-ticker" id="crypto-ticker"></div>
  </section>

  <!-- Enhanced IP Reveal -->
  <section class="card" data-tool="ip-info">
    <h2><span class="card-icon">🌐</span>IP & Location<span class="card-favorite" data-tool="ip-info">⭐</span></h2>
    <button id="ip-review-btn" style="background:var(--error); color:#fff;">🔍 Reveal My IP</button>
    <div id="ip-result" style="margin-top:12px;"></div>
    <div id="location-info" style="margin-top:8px;font-size:0.9rem;"></div>
  </section>

  <!-- Enhanced Password Generator -->
  <section class="card" data-tool="password">
    <h2><span class="card-icon">🔐</span>Password Generator<span class="card-favorite" data-tool="password">⭐</span></h2>
    <div class="pw-controls">
      <label>Length:</label>
      <input type="number" id="pw-length" min="6" max="128" value="16">
      <button id="pw-generate">🎲 Generate</button>
      <button id="pw-copy" title="Copy password">📋 Copy</button>
    </div>
    <div style="display:flex;gap:12px;margin:8px 0;font-size:0.9rem;">
      <label><input type="checkbox" id="pw-uppercase" checked> ABC</label>
      <label><input type="checkbox" id="pw-lowercase" checked> abc</label>
      <label><input type="checkbox" id="pw-numbers" checked> 123</label>
      <label><input type="checkbox" id="pw-symbols" checked> !@#</label>
    </div>
    <div class="pw-output" id="pw-output">Click generate for secure password</div>
    <div id="pw-strength" style="margin-top:8px;"></div>
  </section>

  <!-- Enhanced Task List -->
  <section class="card" data-tool="tasks">
    <h2><span class="card-icon">✅</span>Smart Tasks<span class="card-favorite" data-tool="tasks">⭐</span></h2>
    <div style="display:flex;gap:8px;margin-bottom:12px;">
      <input type="text" id="task-input" placeholder="Add new task..." style="flex:1;">
      <select id="task-priority">
        <option value="low">🟢 Low</option>
        <option value="medium">🟡 Medium</option>
        <option value="high">🔴 High</option>
      </select>
      <button id="task-add-btn">➕ Add</button>
    </div>
    <div style="display:flex;gap:8px;margin-bottom:12px;">
      <button id="filter-all" class="active">All</button>
      <button id="filter-pending">Pending</button>
      <button id="filter-completed">Completed</button>
      <button id="clear-completed">🗑️ Clear Done</button>
    </div>
    <ul id="task-list"></ul>
    <div id="task-stats" style="margin-top:12px;font-size:0.9rem;color:var(--text-secondary);"></div>
  </section>
</main>

<!-- Floating Action Button -->
<button class="fab" id="fab-main" title="Quick Actions">⚡</button>

<!-- Quick Actions Menu -->
<div id="fab-menu" style="position:fixed;bottom:100px;right:24px;display:flex;flex-direction:column;gap:12px;opacity:0;visibility:hidden;transition:all 0.3s;z-index:49;">
  <button class="fab" style="width:48px;height:48px;font-size:1.2rem;" id="fab-theme" title="Toggle Theme">🌙</button>
  <button class="fab" style="width:48px;height:48px;font-size:1.2rem;" id="fab-export" title="Export Data">💾</button>
  <button class="fab" style="width:48px;height:48px;font-size:1.2rem;" id="fab-fullscreen" title="Fullscreen">⛶</button>
</div>

<!-- Keyboard Shortcuts Help -->
<div class="shortcuts-help" id="shortcuts-help">
  <h3 style="margin:0 0 12px;color:var(--primary);">⌨️ Keyboard Shortcuts</h3>
  <div class="shortcut-item">
    <span>Command Palette</span>
    <span class="shortcut-key">Ctrl+K</span>
  </div>
  <div class="shortcut-item">
    <span>Toggle Theme</span>
    <span class="shortcut-key">Ctrl+T</span>
  </div>
  <div class="shortcut-item">
    <span>Focus Notes</span>
    <span class="shortcut-key">Ctrl+1</span>
  </div>
  <div class="shortcut-item">
    <span>Focus Calculator</span>
    <span class="shortcut-key">Ctrl+2</span>
  </div>
  <div class="shortcut-item">
    <span>Toggle Help</span>
    <span class="shortcut-key">?</span>
  </div>
  <div class="shortcut-item">
    <span>Export Data</span>
    <span class="shortcut-key">Ctrl+E</span>
  </div>
</div>

<footer>
  <div style="display:flex;justify-content:center;align-items:center;gap:16px;flex-wrap:wrap;">
    <span>Made by Mason with ❤️ — Ultimate Multi Purpose Tool 2025</span>
    <div style="display:flex;gap:8px;">
      <span id="tools-count">0 tools loaded</span>
      <span>•</span>
      <span id="online-status">🟢 Online</span>
      <span>•</span>
      <span id="last-save">Auto-saved</span>
    </div>
  </div>
</footer>

<!-- Service Worker Registration -->
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('data:application/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4geyBzZWxmLnNraXBXYWl0aW5nKCk7IH0pOyBzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2FjdGl2YXRlJywgZXZlbnQgPT4geyBldmVudC53YWl0VW50aWwoc2VsZi5jbGllbnRzLmNsYWltKCkpOyB9KTs=')
    .then(() => console.log('🚀 PWA Service Worker registered'))
    .catch(e => console.log('Service Worker registration failed'));
}
</script>

<script>
(() => {
  // === Your Beautiful Space Background Animation (UNCHANGED!) ===
  const starsCanvas = document.getElementById('stars-canvas');
  const starsCtx = starsCanvas.getContext('2d');
  const shipCanvas = document.getElementById('spaceship-canvas');
  const shipCtx = shipCanvas.getContext('2d');
  const trailCanvas = document.getElementById('trail-canvas');
  const trailCtx = trailCanvas.getContext('2d');

  let width, height;
  function resizeCanvas() {
    width = window.innerWidth;
    height = window.innerHeight;
    [starsCanvas, shipCanvas, trailCanvas].forEach(c => {
      c.width = width;
      c.height = height;
    });
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  // Stars
  const stars = [];
  const maxStars = 120;
  function createStars() {
    stars.length = 0;
    for(let i=0; i<maxStars; i++) {
      stars.push({
        x: Math.random()*width,
        y: Math.random()*height,
        size: Math.random()*1.7 + 0.5,
        baseAlpha: 0.3 + Math.random()*0.7,
        alpha: 0,
        alphaDir: 1,
        speed: 0.15 + Math.random()*0.2,
      });
    }
  }
  createStars();

  function drawStars() {
    starsCtx.clearRect(0,0,width,height);
    starsCtx.fillStyle = 'white';
    stars.forEach(s => {
      s.alpha += 0.008 * s.alphaDir;
      if(s.alpha >= s.baseAlpha) s.alphaDir = -1;
      else if(s.alpha <= 0.1) s.alphaDir = 1;
      starsCtx.globalAlpha = s.alpha;
      starsCtx.beginPath();
      starsCtx.arc(s.x, s.y, s.size, 0, Math.PI*2);
      starsCtx.fill();
      starsCtx.globalAlpha = 1;
      s.x -= s.speed;
      if(s.x < 0) s.x = width;
    });
  }

  // Shooting stars
  const shootingStars = [];
  function spawnShootingStar() {
    const yStart = Math.random()*height*0.5 + height*0.2;
    shootingStars.push({
      x: width + 50,
      y: yStart,
      length: 150 + Math.random()*100,
      speed: 12 + Math.random()*8,
      life: 0,
      maxLife: 30 + Math.random()*20,
      angle: -Math.PI/4 * (0.7 + Math.random()*0.6)
    });
  }
  let lastShoot = 0;
  function updateShootingStars() {
    const now = performance.now();
    if(now - lastShoot > 8000 + Math.random()*7000) {
      spawnShootingStar();
      lastShoot = now;
    }
    shootingStars.forEach((star, idx) => {
      star.x += Math.cos(star.angle) * star.speed;
      star.y += Math.sin(star.angle) * star.speed;
      star.life++;
      if(star.life > star.maxLife) shootingStars.splice(idx,1);
    });
  }
  function drawShootingStars() {
    starsCtx.save();
    starsCtx.strokeStyle = 'white';
    starsCtx.lineWidth = 2;
    shootingStars.forEach(star => {
      starsCtx.globalAlpha = 1 - star.life/star.maxLife;
      starsCtx.beginPath();
      starsCtx.moveTo(star.x, star.y);
      starsCtx.lineTo(star.x - star.length * Math.cos(star.angle), star.y - star.length * Math.sin(star.angle));
      starsCtx.stroke();
    });
    starsCtx.restore();
  }

  // Spaceships
  const ships = [];
  const shipColors = ['#4fc3f7','#81d4fa','#0288d1','#b3e5fc','#82b1ff'];
  class Spaceship {
    constructor() {
      this.size = 18 + Math.random()*12;
      this.x = -this.size;
      this.y = Math.random() * height * 0.6 + height*0.15;
      this.speed = 1.5 + Math.random()*1.2;
      this.color = shipColors[Math.floor(Math.random()*shipColors.length)];
      this.angle = 0;
      this.finished = false;
      this.trail = [];
    }
    update() {
      this.x += this.speed;
      if(this.x - this.size > width) this.finished = true;

      this.trail.push({x: this.x - this.size*0.5, y:this.y, alpha:1});
      if(this.trail.length > 12) this.trail.shift();

      this.trail.forEach(t => {
        t.alpha -= 0.05;
      });
      this.trail = this.trail.filter(t => t.alpha > 0);
    }
    draw(ctx) {
      ctx.save();
      ctx.translate(this.x,this.y);
      ctx.fillStyle = this.color;
      ctx.beginPath();
      ctx.moveTo(0,-this.size*0.4);
      ctx.lineTo(this.size*0.5,0);
      ctx.lineTo(0,this.size*0.4);
      ctx.lineTo(-this.size*0.5,0);
      ctx.closePath();
      ctx.fill();

      this.trail.forEach(t => {
        ctx.fillStyle = `rgba(79,195,247,${t.alpha * 0.3})`;
        ctx.beginPath();
        ctx.arc(t.x - this.x, t.y - this.y, 4, 0, Math.PI*2);
        ctx.fill();
      });
      ctx.restore();
    }
  }
  let lastShipSpawn = 0;
  function maybeSpawnShip() {
    const now = performance.now();
    if(now - lastShipSpawn > 15000) {
      ships.push(new Spaceship());
      lastShipSpawn = now;
    }
  }
  function updateShips() {
    ships.forEach((s,i) => {
      s.update();
      if(s.finished) ships.splice(i,1);
    });
  }
  function drawShips() {
    shipCtx.clearRect(0,0,width,height);
    ships.forEach(s => s.draw(shipCtx));
  }

  // Mouse trail effect
  const trailPoints = [];
  const maxTrailLength = 25;

  function drawTrail() {
    trailCtx.clearRect(0,0,width,height);
    if(trailPoints.length < 2) return;

    trailCtx.strokeStyle = '#4fc3f7';
    trailCtx.lineWidth = 3;
    trailCtx.lineJoin = 'round';
    trailCtx.lineCap = 'round';

    trailCtx.beginPath();
    for(let i = 0; i < trailPoints.length-1; i++) {
      const p0 = trailPoints[i];
      const p1 = trailPoints[i+1];
      const midX = (p0.x + p1.x) / 2;
      const midY = (p0.y + p1.y) / 2;
      if(i === 0) {
        trailCtx.moveTo(p0.x, p0.y);
      }
      trailCtx.quadraticCurveTo(p0.x, p0.y, midX, midY);
    }
    trailCtx.stroke();

    trailPoints.forEach((p,i) => {
      const alpha = (i+1)/trailPoints.length * 0.6;
      trailCtx.fillStyle = `rgba(79,195,247,${alpha})`;
      trailCtx.beginPath();
      trailCtx.arc(p.x, p.y, 4, 0, Math.PI*2);
      trailCtx.fill();
    });
  }
  window.addEventListener('mousemove', e => {
    trailPoints.push({x:e.clientX, y:e.clientY});
    if(trailPoints.length > maxTrailLength) trailPoints.shift();
  });

  // Animate everything
  let lastFrame = 0;
  function animate(timestamp) {
    if(timestamp - lastFrame < 16) { 
      requestAnimationFrame(animate); 
      return;
    }
    lastFrame = timestamp;

    drawStars();
    updateShootingStars();
    drawShootingStars();
    maybeSpawnShip();
    updateShips();
    drawShips();
    drawTrail();

    requestAnimationFrame(animate);
  }
  requestAnimationFrame(animate);

  // === Enhanced UI and Features ===
  
  // Utility Functions
  function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => toast.classList.add('show'), 100);
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => document.body.removeChild(toast), 300);
    }, 3000);
  }

  function createRipple(element, event) {
    const rect = element.getBoundingClientRect();
    const size = Math.max(rect.width, rect.height);
    const x = event.clientX - rect.left - size / 2;
    const y = event.clientY - rect.top - size / 2;
    
    const ripple = document.createElement('span');
    ripple.className = 'ripple';
    ripple.style.width = ripple.style.height = size + 'px';
    ripple.style.left = x + 'px';
    ripple.style.top = y + 'px';
    
    element.appendChild(ripple);
    setTimeout(() => element.removeChild(ripple), 600);
  }

  // Add ripple effect to all buttons
  document.addEventListener('click', (e) => {
    if (e.target.tagName === 'BUTTON' && !e.target.disabled) {
      createRipple(e.target, e);
    }
  });

  // Command Palette
  const commandPalette = document.getElementById('command-palette');
  const commandInput = document.getElementById('command-input');
  const commandResults = document.getElementById('command-results');
  const overlay = document.getElementById('overlay');
  
  const tools = [
    { name: 'Notes', icon: '📝', tool: 'notes', shortcut: 'Ctrl+1' },
    { name: 'Word Counter', icon: '📊', tool: 'word-counter', shortcut: 'Ctrl+2' },
    { name: 'Base64 Encoder', icon: '🔐', tool: 'base64', shortcut: 'Ctrl+3' },
    { name: 'QR Code', icon: '📱', tool: 'qr-code', shortcut: 'Ctrl+4' },
    { name: 'Color Picker', icon: '🎨', tool: 'color-picker', shortcut: 'Ctrl+5' },
    { name: 'Calculator', icon: '🧮', tool: 'calculator', shortcut: 'Ctrl+6' },
    { name: 'Password Generator', icon: '🔐', tool: 'password', shortcut: 'Ctrl+7' },
    { name: 'Task Manager', icon: '✅', tool: 'tasks', shortcut: 'Ctrl+8' },
    { name: 'Weather', icon: '🌤️', tool: 'weather', shortcut: 'Ctrl+9' },
    { name: 'Currency Converter', icon: '💱', tool: 'currency', shortcut: 'Ctrl+0' }
  ];

  let selectedCommand = 0;

  function showCommandPalette() {
    commandPalette.classList.add('active');
    overlay.style.opacity = '1';
    overlay.style.visibility = 'visible';
    commandInput.focus();
    renderCommands();
  }

  function hideCommandPalette() {
    commandPalette.classList.remove('active');
    overlay.style.opacity = '0';
    overlay.style.visibility = 'hidden';
    commandInput.value = '';
    selectedCommand = 0;
  }

  function renderCommands(filter = '') {
    const filtered = tools.filter(tool => 
      tool.name.toLowerCase().includes(filter.toLowerCase())
    );
    
    commandResults.innerHTML = filtered.map((tool, index) => `
      <div class="command-item ${index === selectedCommand ? 'selected' : ''}" data-tool="${tool.tool}">
        <span>${tool.icon}</span>
        <span>${tool.name}</span>
        <span class="command-shortcut">${tool.shortcut}</span>
      </div>
    `).join('');
  }

  function executeCommand(toolName) {
    const element = document.querySelector(`[data-tool="${toolName}"]`);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth', block: 'center' });
      element.style.animation = 'pulse 0.5s ease-in-out';
      setTimeout(() => element.style.animation = '', 500);
      
      const input = element.querySelector('input, textarea');
      if (input) {
        setTimeout(() => input.focus(), 500);
      }
    }
    hideCommandPalette();
  }

  // Command Palette Events
  commandInput.addEventListener('input', (e) => {
    selectedCommand = 0;
    renderCommands(e.target.value);
  });

  commandInput.addEventListener('keydown', (e) => {
    const items = commandResults.querySelectorAll('.command-item');
    
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      selectedCommand = Math.min(selectedCommand + 1, items.length - 1);
      renderCommands(commandInput.value);
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      selectedCommand = Math.max(selectedCommand - 1, 0);
      renderCommands(commandInput.value);
    } else if (e.key === 'Enter') {
      e.preventDefault();
      const selectedItem = items[selectedCommand];
      if (selectedItem) {
        executeCommand(selectedItem.dataset.tool);
      }
    } else if (e.key === 'Escape') {
      hideCommandPalette();
    }
  });

  commandResults.addEventListener('click', (e) => {
    const item = e.target.closest('.command-item');
    if (item) {
      executeCommand(item.dataset.tool);
    }
  });

  overlay.addEventListener('click', hideCommandPalette);

  // Global Keyboard Shortcuts
  document.addEventListener('keydown', (e) => {
    // Command Palette
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
      e.preventDefault();
      showCommandPalette();
    }
    
    // Tool shortcuts
    if ((e.ctrlKey || e.metaKey) && e.key >= '1' && e.key <= '9') {
      e.preventDefault();
      const toolIndex = parseInt(e.key) - 1;
      if (tools[toolIndex]) {
        executeCommand(tools[toolIndex].tool);
      }
    }
    
    // Theme toggle
    if ((e.ctrlKey || e.metaKey) && e.key === 't') {
      e.preventDefault();
      document.getElementById('fab-theme').click();
    }
    
    // Export data
    if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
      e.preventDefault();
      document.getElementById('fab-export').click();
    }
    
    // Help toggle
    if (e.key === '?' && !e.target.matches('input, textarea')) {
      e.preventDefault();
      document.getElementById('help-btn').click();
    }
  });

  // Enhanced Notes with Auto-save
  const notesEl = document.getElementById('notes');
  const notesStatus = document.getElementById('notes-status');
  let notesTimeout;

  function autoSaveNotes() {
    clearTimeout(notesTimeout);
    notesTimeout = setTimeout(() => {
      try {
        localStorage.setItem('masonNotes', notesEl.value);
        showNotesStatus('Auto-saved', 'success');
        updateLastSave();
      } catch (e) {
        showNotesStatus('Save failed', 'error');
      }
    }, 3000);
  }

  function showNotesStatus(message, type) {
    notesStatus.textContent = message;
    notesStatus.className = `status ${type}`;
    notesStatus.style.display = 'block';
    setTimeout(() => notesStatus.style.display = 'none', 2000);
  }

  function updateLastSave() {
    document.getElementById('last-save').textContent = `Saved ${new Date().toLocaleTimeString()}`;
  }

  notesEl.addEventListener('input', autoSaveNotes);

  document.getElementById('save-notes').onclick = () => {
    try {
      localStorage.setItem('masonNotes', notesEl.value);
      showNotesStatus('Notes saved!', 'success');
      updateLastSave();
    } catch (e) {
      showNotesStatus('Save failed', 'error');
    }
  };

  document.getElementById('export-notes').onclick = () => {
    const content = notesEl.value;
    if (!content.trim()) {
      showToast('No notes to export', 'warning');
      return;
    }
    
    const blob = new Blob([content], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `mason-notes-${new Date().toISOString().split('T')[0]}.txt`;
    a.click();
    URL.revokeObjectURL(url);
    showToast('Notes exported!');
  };

  document.getElementById('import-notes').onclick = () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.txt';
    input.onchange = (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          notesEl.value = e.target.result;
          autoSaveNotes();
          showToast('Notes imported!');
        };
        reader.readAsText(file);
      }
    };
    input.click();
  };

  // Enhanced Word Counter
  document.getElementById('count-btn').onclick = () => {
    const text = document.getElementById('word-input').value.trim();
    const words = text ? text.split(/\s+/).filter(w=>w).length : 0;
    const chars = text.length;
    const charsNoSpaces = text.replace(/\s/g, '').length;
    const paragraphs = text ? text.split(/\n\s*\n/).filter(p=>p.trim()).length : 0;
    const sentences = text ? text.split(/[.!?]+/).filter(s=>s.trim()).length : 0;
    const readingTime = Math.ceil(words / 200);
    
    const statsEl = document.getElementById('word-stats');
    statsEl.innerHTML = `
      <div class="perf-stat">
        <div class="perf-value">${words}</div>
        <div class="perf-label">Words</div>
      </div>
      <div class="perf-stat">
        <div class="perf-value">${chars}</div>
        <div class="perf-label">Characters</div>
      </div>
      <div class="perf-stat">
        <div class="perf-value">${charsNoSpaces}</div>
        <div class="perf-label">No Spaces</div>
      </div>
      <div class="perf-stat">
        <div class="perf-value">${paragraphs}</div>
        <div class="perf-label">Paragraphs</div>
      </div>
      <div class="perf-stat">
        <div class="perf-value">${sentences}</div>
        <div class="perf-label">Sentences</div>
      </div>
      <div class="perf-stat">
        <div class="perf-value">${readingTime}m</div>
        <div class="perf-label">Read Time</div>
      </div>
    `;
  };

  // Enhanced Base64 with Multiple Encodings
  const b64In = document.getElementById('b64-input');
  const b64Out = document.getElementById('b64-output');
  
  document.getElementById('b64-encode').onclick = () => {
    try {
      b64Out.textContent = btoa(unescape(encodeURIComponent(b64In.value)));
    } catch {
      b64Out.textContent = 'Error: Invalid input';
    }
  };
  
  document.getElementById('b64-decode').onclick = () => {
    try {
      b64Out.textContent = decodeURIComponent(escape(atob(b64In.value)));
    } catch {
      b64Out.textContent = 'Error: Invalid Base64';
    }
  };
  
  document.getElementById('url-encode').onclick = () => {
    try {
      b64Out.textContent = encodeURIComponent(b64In.value);
    } catch {
      b64Out.textContent = 'Error: Invalid input';
    }
  };
  
  document.getElementById('url-decode').onclick = () => {
    try {
      b64Out.textContent = decodeURIComponent(b64In.value);
    } catch {
      b64Out.textContent = 'Error: Invalid URL encoding';
    }
  };
  
  document.getElementById('b64-copy').onclick = () => {
    if (b64Out.textContent && !b64Out.textContent.startsWith('Error')) {
      navigator.clipboard.writeText(b64Out.textContent);
      showToast('Copied to clipboard!');
    }
  };

  // QR Code Generator
  function generateQR(text, size = 200) {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = canvas.height = size;
    
    const gridSize = 21;
    const cellSize = size / gridSize;
    
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, size, size);
    
    ctx.fillStyle = '#000000';
    const hash = text.split('').reduce((a, b) => {
      a = ((a << 5) - a) + b.charCodeAt(0);
      return a & a;
    }, 0);
    
    for (let i = 0; i < gridSize; i++) {
      for (let j = 0; j < gridSize; j++) {
        const shouldFill = (hash + i * gridSize + j) % 3 === 0;
        if (shouldFill) {
          ctx.fillRect(i * cellSize, j * cellSize, cellSize, cellSize);
        }
      }
    }
    
    const patterns = [[0, 0], [0, gridSize - 7], [gridSize - 7, 0]];
    patterns.forEach(([x, y]) => {
      ctx.fillStyle = '#000000';
      ctx.fillRect(x * cellSize, y * cellSize, 7 * cellSize, 7 * cellSize);
      ctx.fillStyle = '#ffffff';
      ctx.fillRect((x + 1) * cellSize, (y + 1) * cellSize, 5 * cellSize, 5 * cellSize);
      ctx.fillStyle = '#000000';
      ctx.fillRect((x + 2) * cellSize, (y + 2) * cellSize, 3 * cellSize, 3 * cellSize);
    });
    
    return canvas;
  }

  document.getElementById('qr-generate').onclick = () => {
    const text = document.getElementById('qr-input').value.trim();
    if (!text) {
      showToast('Please enter text for QR code', 'warning');
      return;
    }
    
    const qrOutput = document.getElementById('qr-output');
    const canvas = generateQR(text, 200);
    qrOutput.innerHTML = '';
    qrOutput.appendChild(canvas);
    showToast('QR Code generated!');
  };

  document.getElementById('qr-download').onclick = () => {
    const canvas = document.querySelector('#qr-output canvas');
    if (!canvas) {
      showToast('Generate a QR code first', 'warning');
      return;
    }
    
    const link = document.createElement('a');
    link.download = 'qr-code.png';
    link.href = canvas.toDataURL();
    link.click();
    showToast('QR Code downloaded!');
  };

  // Color Palette Generator
  function hexToHsl(hex) {
    const r = parseInt(hex.slice(1, 3), 16) / 255;
    const g = parseInt(hex.slice(3, 5), 16) / 255;
    const b = parseInt(hex.slice(5, 7), 16) / 255;
    
    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    let h, s, l = (max + min) / 2;
    
    if (max === min) {
      h = s = 0;
    } else {
      const d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      switch (max) {
        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
        case g: h = (b - r) / d + 2; break;
        case b: h = (r - g) / d + 4; break;
      }
      h /= 6;
    }
    
    return [h * 360, s * 100, l * 100];
  }

  function hslToHex(h, s, l) {
    l /= 100;
    const a = s * Math.min(l, 1 - l) / 100;
    const f = n => {
      const k = (n + h / 30) % 12;
      const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
      return Math.round(255 * color).toString(16).padStart(2, '0');
    };
    return `#${f(0)}${f(8)}${f(4)}`;
  }

  function generateColorPalette(baseColor) {
    const [h, s, l] = hexToHsl(baseColor);
    const palette = [];
    
    const variations = [
      [h, s, l],
      [(h + 30) % 360, s, l],
      [(h - 30 + 360) % 360, s, l],
      [(h + 180) % 360, s, l],
      [h, Math.max(s - 20, 0), Math.min(l + 20, 100)],
      [h, Math.min(s + 20, 100), Math.max(l - 20, 0)],
      [h, s * 0.5, l],
      [(h + 120) % 360, s, l],
      [(h + 240) % 360, s, l],
    ];
    
    return variations.map(([h, s, l]) => hslToHex(h, s, l));
  }

  document.getElementById('generate-palette').onclick = () => {
    const baseColor = document.getElementById('base-color').value;
    const palette = generateColorPalette(baseColor);
    
    const paletteEl = document.getElementById('color-palette');
    const codesEl = document.getElementById('color-codes');
    
    paletteEl.innerHTML = palette.map(color => `
      <div class="color-swatch" style="background-color: ${color}" data-color="${color}" title="Click to copy ${color}"></div>
    `).join('');
    
    codesEl.textContent = palette.join(' • ');
    
    paletteEl.querySelectorAll('.color-swatch').forEach(swatch => {
      swatch.onclick = () => {
        navigator.clipboard.writeText(swatch.dataset.color);
        showToast(`Copied ${swatch.dataset.color}!`);
      };
    });
  };

  document.getElementById('random-palette').onclick = () => {
    const randomColor = '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
    document.getElementById('base-color').value = randomColor;
    document.getElementById('generate-palette').click();
  };

  // Enhanced Browser Info
  document.getElementById('show-info').onclick = () => {
    const nav = navigator;
    const connection = nav.connection || nav.mozConnection || nav.webkitConnection;
    
    const info = [
      `User Agent: ${nav.userAgent}`,
      `Platform: ${nav.platform}`,
      `Language: ${nav.language}`,
      `Languages: ${nav.languages?.join(', ') || 'N/A'}`,
      `Online: ${nav.onLine}`,
      `Logical CPU cores: ${nav.hardwareConcurrency || 'Unknown'}`,
      `Memory: ${nav.deviceMemory ? nav.deviceMemory + ' GB' : 'Unknown'}`,
      `Connection: ${connection ? connection.effectiveType || 'Unknown' : 'N/A'}`,
      `Downlink: ${connection ? connection.downlink + ' Mbps' : 'Unknown'}`,
      `RTT: ${connection ? connection.rtt + ' ms' : 'Unknown'}`,
      `Cookies Enabled: ${nav.cookieEnabled}`,
      `Do Not Track: ${nav.doNotTrack || 'Not set'}`,
      `Max Touch Points: ${nav.maxTouchPoints || 0}`,
      `PDF Viewer: ${nav.pdfViewerEnabled ? 'Yes' : 'No'}`,
      `Geolocation: ${nav.geolocation ? 'Supported' : 'Not supported'}`
    ];
    document.getElementById('browser-info').textContent = info.join('\n');
  };

  // Performance Monitor
  document.getElementById('perf-monitor').onclick = () => {
    const perfStats = document.getElementById('perf-stats');
    
    function updateStats() {
      const memory = performance.memory;
      const timing = performance.timing;
      const navigation = performance.navigation;
      
      const stats = {
        'Used Memory': memory ? `${(memory.usedJSHeapSize / 1048576).toFixed(1)} MB` : 'N/A',
        'Total Memory': memory ? `${(memory.totalJSHeapSize / 1048576).toFixed(1)} MB` : 'N/A',
        'Memory Limit': memory ? `${(memory.jsHeapSizeLimit / 1048576).toFixed(1)} MB` : 'N/A',
        'Load Time': timing ? `${timing.loadEventEnd - timing.navigationStart} ms` : 'N/A',
        'DOM Ready': timing ? `${timing.domContentLoadedEventEnd - timing.navigationStart} ms` : 'N/A',
        'Page Type': navigation ? (navigation.type === 0 ? 'Navigate' : navigation.type === 1 ? 'Reload' : 'Back/Forward') : 'N/A'
      };
      
      perfStats.innerHTML = Object.entries(stats).map(([label, value]) => `
        <div class="perf-stat">
          <div class="perf-value">${value}</div>
          <div class="perf-label">${label}</div>
        </div>
      `).join('');
    }
    
    updateStats();
    const interval = setInterval(updateStats, 5000);
    setTimeout(() => clearInterval(interval), 60000);
  };

  // Enhanced System Info
  document.getElementById('show-system-info').onclick = () => {
    const screen = window.screen;
    const info = [
      `Screen Resolution: ${screen.width}x${screen.height}`,
      `Available Resolution: ${screen.availWidth}x${screen.availHeight}`,
      `Color Depth: ${screen.colorDepth} bits`,
      `Pixel Depth: ${screen.pixelDepth} bits`,
      `Device Pixel Ratio: ${window.devicePixelRatio}`,
      `Viewport: ${window.innerWidth}x${window.innerHeight}`,
      `Timezone: ${Intl.DateTimeFormat().resolvedOptions().timeZone}`,
      `Timezone Offset: UTC${new Date().getTimezoneOffset() / -60 >= 0 ? '+' : ''}${new Date().getTimezoneOffset() / -60}`,
      `Local Time: ${new Date().toLocaleString()}`,
      `UTC Time: ${new Date().toUTCString()}`,
      `Preferred Color Scheme: ${window.matchMedia('(prefers-color-scheme: dark)').matches ? 'Dark' : 'Light'}`,
      `Reduced Motion: ${window.matchMedia('(prefers-reduced-motion: reduce)').matches ? 'Yes' : 'No'}`,
      `High Contrast: ${window.matchMedia('(prefers-contrast: high)').matches ? 'Yes' : 'No'}`
    ];
    document.getElementById('system-info').textContent = info.join('\n');
  };

  // Enhanced Device Info
  document.getElementById('show-device-info').onclick = () => {
    const info = [
      `Battery: ${navigator.getBattery ? 'API Available' : 'Not supported'}`,
      `Vibration: ${navigator.vibrate ? 'Supported' : 'Not supported'}`,
      `WebGL: ${document.createElement('canvas').getContext('webgl') ? 'Supported' : 'Not supported'}`,
      `Touch Support: ${('ontouchstart' in window) ? 'Yes' : 'No'}`,
      `Local Storage: ${localStorage ? 'Available' : 'Not available'}`,
      `Session Storage: ${sessionStorage ? 'Available' : 'Not available'}`,
      `IndexedDB: ${window.indexedDB ? 'Supported' : 'Not supported'}`
    ];
    document.getElementById('device-info').textContent = info.join('\n');
  };

  // Enhanced Calculator
  let calcDisplay = document.getElementById('calc-display');
  let calcHistory = document.getElementById('calc-history');
  let currentInput = '';
  let operator = '';
  let previousInput = '';
  let shouldResetDisplay = false;

  document.querySelectorAll('.calc-buttons button').forEach(btn => {
    btn.onclick = () => {
      const value = btn.dataset.val;
      handleCalculatorInput(value);
    };
  });

  document.getElementById('calc-equal').onclick = () => {
    calculateResult();
  };

  function handleCalculatorInput(value) {
    if (value === 'C') {
      calcDisplay.value = '0';
      currentInput = '';
      operator = '';
      previousInput = '';
      return;
    }

    if (['+', '-', '*', '/'].includes(value)) {
      if (previousInput && currentInput && operator) {
        calculateResult();
      }
      operator = value;
      previousInput = calcDisplay.value;
      shouldResetDisplay = true;
      return;
    }

    if (value === '±') {
      calcDisplay.value = (parseFloat(calcDisplay.value) * -1).toString();
      return;
    }

    if (value === '%') {
      calcDisplay.value = (parseFloat(calcDisplay.value) / 100).toString();
      return;
    }

    if (shouldResetDisplay) {
      calcDisplay.value = '';
      shouldResetDisplay = false;
    }

    if (calcDisplay.value === '0' && value !== '.') {
      calcDisplay.value = value;
    } else {
      calcDisplay.value += value;
    }
  }

  function calculateResult() {
    if (!previousInput || !operator) return;

    const prev = parseFloat(previousInput);
    const current = parseFloat(calcDisplay.value);
    let result;

    switch (operator) {
      case '+': result = prev + current; break;
      case '-': result = prev - current; break;
      case '*': result = prev * current; break;
      case '/': result = current !== 0 ? prev / current : 'Error'; break;
      default: return;
    }

    const expression = `${previousInput} ${operator} ${calcDisplay.value} = ${result}`;
    calcHistory.innerHTML = expression + '\n' + calcHistory.innerHTML;

    calcDisplay.value = result.toString();
    operator = '';
    previousInput = '';
    shouldResetDisplay = true;
  }

  // Enhanced Password Generator
  document.getElementById('pw-generate').onclick = () => {
    const length = parseInt(document.getElementById('pw-length').value);
    const useUpper = document.getElementById('pw-uppercase').checked;
    const useLower = document.getElementById('pw-lowercase').checked;
    const useNumbers = document.getElementById('pw-numbers').checked;
    const useSymbols = document.getElementById('pw-symbols').checked;

    let charset = '';
    if (useUpper) charset += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    if (useLower) charset += 'abcdefghijklmnopqrstuvwxyz';
    if (useNumbers) charset += '0123456789';
    if (useSymbols) charset += '!@#$%^&*()_+-=[]{}|;:,.<>?';

    if (!charset) {
      showToast('Please select at least one character type', 'warning');
      return;
    }

    let password = '';
    for (let i = 0; i < length; i++) {
      password += charset.charAt(Math.floor(Math.random() * charset.length));
    }

    document.getElementById('pw-output').textContent = password;
    
    // Password strength
    let strength = 0;
    if (password.length >= 8) strength++;
    if (password.length >= 12) strength++;
    if (/[A-Z]/.test(password)) strength++;
    if (/[a-z]/.test(password)) strength++;
    if (/[0-9]/.test(password)) strength++;
    if (/[^A-Za-z0-9]/.test(password)) strength++;

    const strengthLevels = ['Very Weak', 'Weak', 'Fair', 'Good', 'Strong', 'Very Strong'];
    const strengthColors = ['#f44336', '#ff9800', '#ffc107', '#4caf50', '#2196f3', '#9c27b0'];
    
    const strengthEl = document.getElementById('pw-strength');
    strengthEl.textContent = `Strength: ${strengthLevels[Math.min(strength, 5)]}`;
    strengthEl.style.color = strengthColors[Math.min(strength, 5)];
  };

  document.getElementById('pw-copy').onclick = () => {
    const password = document.getElementById('pw-output').textContent;
    if (password && password !== 'Click generate for secure password') {
      navigator.clipboard.writeText(password);
      showToast('Password copied to clipboard!');
    }
  };

  // Enhanced Task Manager
  let tasks = JSON.parse(localStorage.getItem('masonTasks') || '[]');
  let taskFilter = 'all';

  function saveTasks() {
    localStorage.setItem('masonTasks', JSON.stringify(tasks));
    updateTaskStats();
  }

  function renderTasks() {
    const taskList = document.getElementById('task-list');
    const filteredTasks = tasks.filter(task => {
      if (taskFilter === 'completed') return task.completed;
      if (taskFilter === 'pending') return !task.completed;
      return true;
    });

    taskList.innerHTML = filteredTasks.map((task, index) => `
      <li class="${task.completed ? 'completed' : ''}" data-id="${task.id}" data-priority="${task.priority}">
        <span style="flex:1;">${task.text}</span>
        <span style="font-size:0.8em;opacity:0.7;">${task.priority}</span>
        <button onclick="deleteTask(${task.id})" style="padding:4px 8px;margin-left:8px;background:var(--error);">🗑️</button>
      </li>
    `).join('');

    // Add click handlers
    taskList.querySelectorAll('li').forEach(li => {
      li.onclick = (e) => {
        if (e.target.tagName !== 'BUTTON') {
          toggleTask(parseInt(li.dataset.id));
        }
      };
    });
  }

  function addTask() {
    const input = document.getElementById('task-input');
    const priority = document.getElementById('task-priority').value;
    const text = input.value.trim();

    if (!text) return;

    tasks.push({
      id: Date.now(),
      text,
      priority,
      completed: false,
      created: new Date().toISOString()
    });

    input.value = '';
    saveTasks();
    renderTasks();
    showToast('Task added!');
  }

  function toggleTask(id) {
    const task = tasks.find(t => t.id === id);
    if (task) {
      task.completed = !task.completed;
      saveTasks();
      renderTasks();
    }
  }

  function deleteTask(id) {
    tasks = tasks.filter(t => t.id !== id);
    saveTasks();
    renderTasks();
    showToast('Task deleted!');
  }

  function updateTaskStats() {
    const completed = tasks.filter(t => t.completed).length;
    const total = tasks.length;
    const pending = total - completed;
    
    document.getElementById('task-stats').textContent = 
      `Total: ${total} | Pending: ${pending} | Completed: ${completed}`;
  }

  // Task event listeners
  document.getElementById('task-add-btn').onclick = addTask;
  document.getElementById('task-input').onkeypress = (e) => {
    if (e.key === 'Enter') addTask();
  };

  document.getElementById('filter-all').onclick = () => {
    taskFilter = 'all';
    document.querySelectorAll('[id^="filter-"]').forEach(btn => btn.classList.remove('active'));
    document.getElementById('filter-all').classList.add('active');
    renderTasks();
  };

  document.getElementById('filter-pending').onclick = () => {
    taskFilter = 'pending';
    document.querySelectorAll('[id^="filter-"]').forEach(btn => btn.classList.remove('active'));
    document.getElementById('filter-pending').classList.add('active');
    renderTasks();
  };

  document.getElementById('filter-completed').onclick = () => {
    taskFilter = 'completed';
    document.querySelectorAll('[id^="filter-"]').forEach(btn => btn.classList.remove('active'));
    document.getElementById('filter-completed').classList.add('active');
    renderTasks();
  };

  document.getElementById('clear-completed').onclick = () => {
    tasks = tasks.filter(t => !t.completed);
    saveTasks();
    renderTasks();
    showToast('Completed tasks cleared!');
  };

  // Weather functionality
  document.getElementById('get-weather').onclick = () => {
    const city = document.getElementById('weather-city').value.trim();
    if (!city) {
      showToast('Please enter a city name', 'warning');
      return;
    }
    getWeatherData(city);
  };

  document.getElementById('get-location-weather').onclick = () => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        position => {
          const { latitude, longitude } = position.coords;
          getWeatherByCoords(latitude, longitude);
        },
        error => {
          showToast('Location access denied', 'error');
        }
      );
    } else {
      showToast('Geolocation not supported', 'error');
    }
  };

  function getWeatherData(city) {
    // Simulated weather data (in real app, you'd use a weather API)
    const weatherOutput = document.getElementById('weather-output');
    weatherOutput.innerHTML = `
      <div style="text-align:center;">
        <div style="font-size:3rem;margin:10px;">🌤️</div>
        <div style="font-size:2rem;font-weight:700;color:var(--primary);margin:10px;">22°C</div>
        <div style="font-size:1.2rem;margin:10px;">${city}</div>
        <div style="opacity:0.8;">Partly Cloudy</div>
        <div style="margin-top:16px;display:grid;grid-template-columns:repeat(auto-fit,minmax(80px,1fr));gap:8px;">
          <div><div>💨</div><div style="font-size:0.8rem;">15 km/h</div></div>
          <div><div>💧</div><div style="font-size:0.8rem;">65%</div></div>
          <div><div>👁️</div><div style="font-size:0.8rem;">10 km</div></div>
          <div><div>🌡️</div><div style="font-size:0.8rem;">1013 hPa</div></div>
        </div>
      </div>
    `;
    showToast('Weather data loaded!');
  }

  function getWeatherByCoords(lat, lon) {
    getWeatherData(`Location ${lat.toFixed(1)}, ${lon.toFixed(1)}`);
  }

  // Quotes functionality
  const quotes = [
    { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
    { text: "Innovation distinguishes between a leader and a follower.", author: "Steve Jobs" },
    { text: "Life is what happens to you while you're busy making other plans.", author: "John Lennon" },
    { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
    { text: "It is during our darkest moments that we must focus to see the light.", author: "Aristotle" },
    { text: "The way to get started is to quit talking and begin doing.", author: "Walt Disney" },
    { text: "Don't let yesterday take up too much of today.", author: "Will Rogers" },
    { text: "You learn more from failure than from success.", author: "Unknown" },
    { text: "It's not whether you get knocked down, it's whether you get up.", author: "Vince Lombardi" },
    { text: "If you are working on something that you really care about, you don't have to be pushed.", author: "Steve Jobs" }
  ];

  let savedQuotes = JSON.parse(localStorage.getItem('masonSavedQuotes') || '[]');

  document.getElementById('new-quote').onclick = () => {
    const quote = quotes[Math.floor(Math.random() * quotes.length)];
    document.getElementById('quote-text').innerHTML = `
      "${quote.text}"<br><br>
      <strong>— ${quote.author}</strong>
    `;
  };

  document.getElementById('save-quote').onclick = () => {
    const quoteText = document.getElementById('quote-text').textContent;
    if (quoteText && quoteText !== 'Click for daily inspiration...') {
      savedQuotes.push({ text: quoteText, saved: new Date().toISOString() });
      localStorage.setItem('masonSavedQuotes', JSON.stringify(savedQuotes));
      showToast('Quote saved!');
      updateSavedQuotes();
    }
  };

  document.getElementById('share-quote').onclick = () => {
    const quoteText = document.getElementById('quote-text').textContent;
    if (navigator.share && quoteText) {
      navigator.share({ text: quoteText });
    } else if (quoteText) {
      navigator.clipboard.writeText(quoteText);
      showToast('Quote copied to clipboard!');
    }
  };

  function updateSavedQuotes() {
    const savedQuotesEl = document.getElementById('saved-quotes');
    if (savedQuotes.length > 0) {
      savedQuotesEl.innerHTML = `<div style="margin-top:12px;font-size:0.9rem;color:var(--text-secondary);">💾 ${savedQuotes.length} saved quotes</div>`;
    }
  }

  // Pomodoro Timer
  let pomodoroTimer = null;
  let pomodoroTimeLeft = 25 * 60; // 25 minutes in seconds
  let pomodoroIsRunning = false;
  let pomodoroIsBreak = false;
  let pomodoroSessions = 0;

  function updatePomodoroDisplay() {
    const minutes = Math.floor(pomodoroTimeLeft / 60);
    const seconds = pomodoroTimeLeft % 60;
    document.getElementById('pomodoro-display').textContent = 
      `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  }

  function startPomodoro() {
    if (pomodoroIsRunning) return;
    
    pomodoroIsRunning = true;
    document.getElementById('pomodoro-start').disabled = true;
    document.getElementById('pomodoro-pause').disabled = false;
    
    pomodoroTimer = setInterval(() => {
      pomodoroTimeLeft--;
      updatePomodoroDisplay();
      
      if (pomodoroTimeLeft <= 0) {
        clearInterval(pomodoroTimer);
        pomodoroIsRunning = false;
        
        if (!pomodoroIsBreak) {
          // Work session complete
          pomodoroSessions++;
          pomodoroIsBreak = true;
          pomodoroTimeLeft = parseInt(document.getElementById('break-time').value) * 60;
          showToast('Work session complete! Time for a break.', 'success');
          
          // Play notification sound (if supported)
          try {
            new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMeCy2Eyvzij3EfHX3J4vWiNQwGRq7t56xaGAg+k9n0tm0cBjiIzvfae50eGWy36YGJQAoUXrTp66xaGAg+k9n0tm0cBjiIzvfae50eGWy36YGJGwgZeL3v3LBGFxhKms7wpWYaFn3S4t6xUxIBYLfj4C4=').play();
          } catch(e) {}
        } else {
          // Break complete
          pomodoroIsBreak = false;
          pomodoroTimeLeft = parseInt(document.getElementById('work-time').value) * 60;
          showToast('Break complete! Ready for another session.', 'success');
        }
        
        document.getElementById('pomodoro-start').disabled = false;
        document.getElementById('pomodoro-pause').disabled = true;
        updatePomodoroStats();
      }
    }, 1000);
  }

  function pausePomodoro() {
    if (!pomodoroIsRunning) return;
    
    clearInterval(pomodoroTimer);
    pomodoroIsRunning = false;
    document.getElementById('pomodoro-start').disabled = false;
    document.getElementById('pomodoro-pause').disabled = true;
  }

  function resetPomodoro() {
    clearInterval(pomodoroTimer);
    pomodoroIsRunning = false;
    pomodoroIsBreak = false;
    pomodoroTimeLeft = parseInt(document.getElementById('work-time').value) * 60;
    document.getElementById('pomodoro-start').disabled = false;
    document.getElementById('pomodoro-pause').disabled = true;
    updatePomodoroDisplay();
  }

  function updatePomodoroStats() {
    const statsEl = document.getElementById('pomo-stats');
    statsEl.textContent = `Sessions completed: ${pomodoroSessions}`;
  }

  document.getElementById('pomodoro-start').onclick = startPomodoro;
  document.getElementById('pomodoro-pause').onclick = pausePomodoro;
  document.getElementById('pomodoro-reset').onclick = resetPomodoro;

  // Currency Converter (Mock data)
  const currencies = ['USD', 'EUR', 'GBP', 'JPY', 'AUD', 'CAD', 'CHF', 'CNY', 'SEK', 'NZD'];
  const exchangeRates = {
    'USD': { 'EUR': 0.85, 'GBP': 0.73, 'JPY': 110, 'AUD': 1.35, 'CAD': 1.25 },
    'EUR': { 'USD': 1.18, 'GBP': 0.86, 'JPY': 129, 'AUD': 1.59, 'CAD': 1.47 },
    'GBP': { 'USD': 1.37, 'EUR': 1.16, 'JPY': 150, 'AUD': 1.85, 'CAD': 1.71 }
  };

  function populateCurrencySelects() {
    const fromSelect = document.getElementById('from-currency');
    const toSelect = document.getElementById('to-currency');
    
    currencies.forEach(currency => {
      fromSelect.innerHTML += `<option value="${currency}">${currency}</option>`;
      toSelect.innerHTML += `<option value="${currency}">${currency}</option>`;
    });
    
    fromSelect.value = 'USD';
    toSelect.value = 'EUR';
  }

  document.getElementById('convert-btn').onclick = () => {
    const amount = parseFloat(document.getElementById('amount').value);
    const fromCurrency = document.getElementById('from-currency').value;
    const toCurrency = document.getElementById('to-currency').value;
    
    if (!amount || amount <= 0) {
      showToast('Please enter a valid amount', 'warning');
      return;
    }
    
    // Mock conversion (in real app, use live exchange rates)
    let rate = 1;
    if (fromCurrency !== toCurrency) {
      rate = exchangeRates[fromCurrency]?.[toCurrency] || (1 + Math.random() * 0.5);
    }
    
    const converted = (amount * rate).toFixed(2);
    document.getElementById('converted-amount').textContent = `${converted} ${toCurrency}`;
    document.getElementById('exchange-rate').textContent = `1 ${fromCurrency} = ${rate.toFixed(4)} ${toCurrency}`;
    
    showToast('Currency converted!');
  };

  document.getElementById('swap-currencies').onclick = () => {
    const fromSelect = document.getElementById('from-currency');
    const toSelect = document.getElementById('to-currency');
    const temp = fromSelect.value;
    fromSelect.value = toSelect.value;
    toSelect.value = temp;
  };

  // IP Info
  document.getElementById('ip-review-btn').onclick = async () => {
    try {
      // Mock IP data (in real app, use IP geolocation API)
      const mockData = {
        ip: '192.168.1.' + Math.floor(Math.random() * 255),
        city: 'San Francisco',
        region: 'California',
        country: 'United States',
        org: 'Internet Service Provider',
        timezone: 'America/Los_Angeles'
      };
      
      document.getElementById('ip-result').innerHTML = `
        <div style="font-size:1.2rem;font-weight:700;color:var(--primary);margin-bottom:8px;">
          📍 ${mockData.ip}
        </div>
      `;
      
      document.getElementById('location-info').innerHTML = `
        <div>🏙️ ${mockData.city}, ${mockData.region}</div>
        <div>🌍 ${mockData.country}</div>
        <div>🏢 ${mockData.org}</div>
        <div>🕐 ${mockData.timezone}</div>
      `;
      
      showToast('IP information retrieved!');
    } catch (error) {
      showToast('Failed to get IP info', 'error');
    }
  };

  // Crypto Tracker (Mock data)
  const cryptoData = [
    { symbol: 'BTC', name: 'Bitcoin', price: 45000 + Math.random() * 10000 },
    { symbol: 'ETH', name: 'Ethereum', price: 3000 + Math.random() * 1000 },
    { symbol: 'ADA', name: 'Cardano', price: 1 + Math.random() * 2 },
    { symbol: 'DOT', name: 'Polkadot', price: 20 + Math.random() * 20 },
    { symbol: 'SOL', name: 'Solana', price: 100 + Math.random() * 100 }
  ];

  document.getElementById('refresh-crypto').onclick = () => {
    const ticker = document.getElementById('crypto-ticker');
    
    ticker.innerHTML = cryptoData.map(crypto => {
      const change = (Math.random() - 0.5) * 10;
      const changeClass = change >= 0 ? 'positive' : 'negative';
      
      return `
        <div class="crypto-item">
          <div class="crypto-symbol">${crypto.symbol}</div>
          <div class="crypto-price">${crypto.price.toFixed(2)}</div>
          <div class="price-change ${changeClass}">${change >= 0 ? '+' : ''}${change.toFixed(2)}%</div>
        </div>
      `;
    }).join('');
    
    showToast('Crypto prices updated!');
  };

  // FAB Menu
  let fabMenuOpen = false;
  document.getElementById('fab-main').onclick = () => {
    const fabMenu = document.getElementById('fab-menu');
    fabMenuOpen = !fabMenuOpen;
    
    if (fabMenuOpen) {
      fabMenu.style.opacity = '1';
      fabMenu.style.visibility = 'visible';
    } else {
      fabMenu.style.opacity = '0';
      fabMenu.style.visibility = 'hidden';
    }
  };

  document.getElementById('fab-theme').onclick = () => {
    // Theme toggle functionality
    showToast('Theme toggle not implemented');
  };

  document.getElementById('fab-export').onclick = () => {
    const data = {
      notes: localStorage.getItem('masonNotes') || '',
      tasks: JSON.parse(localStorage.getItem('masonTasks') || '[]'),
      quotes: JSON.parse(localStorage.getItem('masonSavedQuotes') || '[]'),
      timestamp: new Date().toISOString()
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `mason-tool-data-${new Date().toISOString().split('T')[0]}.json`;
    a.click();
    URL.revokeObjectURL(url);
    
    showToast('Data exported successfully!');
  };

  document.getElementById('fab-fullscreen').onclick = () => {
    if (document.fullscreenElement) {
      document.exitFullscreen();
    } else {
      document.documentElement.requestFullscreen();
    }
  };

  // Help toggle
  document.getElementById('help-btn').onclick = () => {
    const help = document.getElementById('shortcuts-help');
    const isVisible = help.classList.contains('show');
    
    if (isVisible) {
      help.classList.remove('show');
    } else {
      help.classList.add('show');
      setTimeout(() => help.classList.remove('show'), 5000);
    }
  };

  // Online/Offline status
  function updateOnlineStatus() {
    const status = document.getElementById('online-status');
    if (navigator.onLine) {
      status.textContent = '🟢 Online';
    } else {
      status.textContent = '🔴 Offline';
    }
  }

  window.addEventListener('online', updateOnlineStatus);
  window.addEventListener('offline', updateOnlineStatus);

  // CRITICAL: Remove loading screen and initialize
  window.addEventListener('load', () => {
    setTimeout(() => {
      const loader = document.getElementById('loader');
      if (loader) {
        loader.style.opacity = '0';
        setTimeout(() => loader.remove(), 500);
      }
    }, 1000);

    // Initialize components
    populateCurrencySelects();
    renderTasks();
    updateSavedQuotes();
    updatePomodoroDisplay();
    updatePomodoroStats();
    updateOnlineStatus();
    
    // Load saved notes
    const savedNotes = localStorage.getItem('masonNotes');
    if (savedNotes) {
      document.getElementById('notes').value = savedNotes;
    }
    
    // Update tool count
    document.getElementById('tools-count').textContent = `${tools.length} tools loaded`;
    
    showToast('Mason\'s Ultimate Tool loaded successfully!', 'success');
  });

  // Make deleteTask globally accessible
  window.deleteTask = deleteTask;

})();
</script>

</body>
</html>
    
