<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mason Tool - Enhanced Space Edition</title>
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiTWFzb24ncyBUb29sIiwic2hvcnRfbmFtZSI6Ik1hc29uVG9vbCIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMDAwIiwidGhlbWVfY29sb3IiOiIjNGZjM2Y3In0=">
<style>
  /* Enhanced Reset & Base */
  * {
    box-sizing: border-box;
  }
  
  :root {
    --primary: #4fc3f7;
    --primary-dark: #0288d1;
    --secondary: #81d4fa;
    --accent: #b3e5fc;
    --bg-dark: #000;
    --bg-card: rgba(18, 18, 18, 0.8);
    --bg-hover: rgba(26, 26, 26, 0.9);
    --text-primary: #eee;
    --text-secondary: #bbb;
    --border: rgba(51, 51, 51, 0.6);
    --border-focus: #4fc3f7;
    --success: #4caf50;
    --warning: #ff9800;
    --error: #f44336;
    --glass-bg: rgba(18, 18, 18, 0.7);
    --glass-border: rgba(255, 255, 255, 0.15);
    --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    --glow: 0 0 20px rgba(79, 195, 247, 0.4);
  }

  body, html {
    margin:0; padding:0;
    background: var(--bg-dark);
    color: var(--text-primary);
    font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
    overflow-x: hidden;
    min-height: 100vh;
    user-select: none;
    font-size: clamp(14px, 1.5vw, 16px);
  }

  /* Enhanced Header */
  header {
    background: rgba(17, 17, 17, 0.9);
    backdrop-filter: blur(20px);
    padding: 16px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--glass-border);
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: var(--shadow);
  }
  
  header .title {
    font-weight: 900;
    font-size: clamp(1.5rem, 4vw, 2.2rem);
    letter-spacing: 3px;
    color: #ffffff;
    text-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
    font-family: 'Arial', sans-serif;
  }

  .header-controls {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  /* Enhanced Buttons */
  button, .btn {
    background: var(--glass-bg);
    backdrop-filter: blur(15px);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    color: var(--text-primary);
    padding: 12px 20px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    user-select: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }
  
  button:hover, .btn:hover {
    background: var(--bg-hover);
    border-color: var(--primary);
    box-shadow: var(--glow);
    transform: translateY(-2px);
  }
  
  button:active, .btn:active {
    transform: translateY(0);
  }
  
  button:disabled {
    background: #111;
    cursor: not-allowed;
    color: #666;
    border-color: #222;
  }

  /* Ripple Effect */
  .ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(79, 195, 247, 0.6);
    transform: scale(0);
    animation: ripple 0.6s linear;
    pointer-events: none;
  }
  
  @keyframes ripple {
    to {
      transform: scale(4);
      opacity: 0;
    }
  }

  /* Command Palette */
  .command-palette {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    width: 90%;
    max-width: 600px;
    max-height: 80vh;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  }
  
  .command-palette.active {
    opacity: 1;
    visibility: visible;
    transform: translate(-50%, -50%) scale(1);
  }
  
  .command-palette input {
    width: 100%;
    padding: 20px 24px;
    background: transparent;
    border: none;
    color: var(--text-primary);
    font-size: 1.1rem;
    outline: none;
    border-bottom: 1px solid var(--glass-border);
  }
  
  .command-results {
    max-height: 400px;
    overflow-y: auto;
    padding: 12px;
  }
  
  .command-item {
    padding: 12px 16px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.2s;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .command-item:hover, .command-item.selected {
    background: var(--bg-hover);
  }
  
  .command-shortcut {
    margin-left: auto;
    color: var(--text-secondary);
    font-size: 0.8rem;
    background: rgba(255, 255, 255, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
  }

  /* Enhanced Main Grid */
  main {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 24px;
    padding: 32px 24px;
    max-width: 1400px;
    margin: 0 auto 40px;
    position: relative;
    z-index: 5;
  }

  /* Enhanced Cards with Glassmorphism */
  section.card {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 24px 28px;
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  section.card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), var(--glow);
    border-color: var(--primary);
  }
  
  section.card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--primary), transparent);
    opacity: 0;
    transition: opacity 0.3s;
  }
  
  section.card:hover::before {
    opacity: 1;
  }
  
  section.card h2 {
    margin: 0 0 20px;
    font-weight: 700;
    font-size: 1.4rem;
    color: var(--text-primary);
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .card-icon {
    font-size: 1.2rem;
    opacity: 0.8;
  }

  /* Enhanced Form Elements */
  textarea, input[type=text], input[type=number], input[type=password], input[type=color], select, pre, .output {
    background: rgba(27, 27, 27, 0.8);
    backdrop-filter: blur(10px);
    color: var(--text-primary);
    border: 1px solid var(--border);
    border-radius: 12px;
    font-family: 'JetBrains Mono', 'Fira Code', monospace;
    font-size: 1rem;
    padding: 14px 16px;
    resize: vertical;
    min-height: 48px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    width: 100%;
  }
  
  textarea:focus, input:focus, select:focus {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px rgba(79, 195, 247, 0.2), var(--glow);
    transform: translateY(-1px);
  }
  
  pre, .output {
    white-space: pre-wrap;
    word-break: break-word;
    min-height: 100px;
    font-family: 'JetBrains Mono', monospace;
    line-height: 1.5;
  }

  /* Media Players */
  audio, video {
    width: 100%;
    margin-top: 12px;
    border-radius: 8px;
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
  }

  video {
    max-height: 300px;
  }

  /* Floating Action Button */
  .fab {
    position: fixed;
    bottom: 24px;
    right: 24px;
    width: 64px;
    height: 64px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    border: none;
    box-shadow: var(--shadow), var(--glow);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 50;
  }
  
  .fab:hover {
    transform: scale(1.1) translateY(-2px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4), 0 0 30px rgba(79, 195, 247, 0.5);
  }

  /* Enhanced Calculator */
  .calc-buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-top: 16px;
  }
  
  .calc-buttons button {
    margin-top: 0;
    font-size: 1.2rem;
    font-weight: 700;
    padding: 18px 0;
    border-radius: 16px;
    transition: all 0.2s;
  }
  
  .calc-buttons button:hover {
    background: var(--primary);
    color: white;
  }
  
  .calc-buttons button:active {
    transform: scale(0.95);
  }

  /* Enhanced Password Generator */
  .pw-controls {
    display: flex;
    gap: 12px;
    align-items: center;
    flex-wrap: wrap;
  }
  
  .pw-controls input[type=number] {
    width: 100px;
  }
  
  .pw-output {
    margin-top: 16px;
    font-family: 'JetBrains Mono', monospace;
    font-weight: 700;
    font-size: 1.1rem;
    padding: 16px;
    background: rgba(34, 34, 34, 0.8);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border);
    border-radius: 12px;
    user-select: text;
    cursor: pointer;
    transition: all 0.3s;
    word-break: break-all;
  }
  
  .pw-output:hover {
    border-color: var(--primary);
    box-shadow: var(--glow);
  }

  /* Enhanced Task List */
  #task-list {
    margin-top: 16px;
    max-height: 300px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--primary) transparent;
  }
  
  #task-list::-webkit-scrollbar {
    width: 6px;
  }
  
  #task-list::-webkit-scrollbar-track {
    background: transparent;
  }
  
  #task-list::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 3px;
  }
  
  #task-list li {
    list-style: none;
    padding: 16px 18px;
    border-bottom: 1px solid var(--glass-border);
    cursor: pointer;
    transition: all 0.3s;
    border-radius: 12px;
    margin-bottom: 8px;
    background: rgba(255, 255, 255, 0.02);
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  #task-list li:hover {
    background: var(--bg-hover);
    transform: translateX(4px);
  }
  
  #task-list li.completed {
    text-decoration: line-through;
    color: var(--text-secondary);
    opacity: 0.6;
  }

  /* Status Indicators */
  .status {
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 0.9rem;
    margin-top: 12px;
    border-left: 4px solid;
    backdrop-filter: blur(10px);
  }
  
  .status.success {
    background: rgba(76, 175, 80, 0.1);
    border-color: var(--success);
    color: var(--success);
  }
  
  .status.warning {
    background: rgba(255, 152, 0, 0.1);
    border-color: var(--warning);
    color: var(--warning);
  }
  
  .status.error {
    background: rgba(244, 67, 54, 0.1);
    border-color: var(--error);
    color: var(--error);
  }

  /* Loading States */
  .loading {
    position: relative;
    pointer-events: none;
  }
  
  .loading::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(2px);
    border-radius: inherit;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .spinner {
    width: 32px;
    height: 32px;
    border: 3px solid rgba(79, 195, 247, 0.3);
    border-top: 3px solid var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Notification Toast */
  .toast {
    position: fixed;
    top: 100px;
    right: 24px;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 16px 20px;
    box-shadow: var(--shadow);
    z-index: 1000;
    transform: translateX(400px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    max-width: 350px;
  }
  
  .toast.show {
    transform: translateX(0);
  }
  
  .toast.success {
    border-left: 4px solid var(--success);
  }
  
  .toast.error {
    border-left: 4px solid var(--error);
  }
  
  .toast.warning {
    border-left: 4px solid var(--warning);
  }

  /* Enhanced Footer */
  footer {
    text-align: center;
    padding: 24px;
    background: rgba(17, 17, 17, 0.95);
    backdrop-filter: blur(20px);
    border-top: 1px solid var(--glass-border);
    font-size: 0.9rem;
    color: var(--text-secondary);
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
    position: relative;
    z-index: 5;
  }

  /* Canvas (Space Background) */
  #stars-canvas, #spaceship-canvas, #trail-canvas {
    position: fixed;
    top: 0; 
    left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    z-index: 1;
  }

  /* Tool container higher z-index */
  main, header, footer {
    position: relative;
    z-index: 5;
  }

  /* Theme selector */
  .theme-selector {
    display: flex;
    gap: 8px;
    background: rgba(255, 255, 255, 0.1);
    padding: 4px;
    border-radius: 12px;
    backdrop-filter: blur(10px);
  }
  
  .theme-btn {
    padding: 8px 12px;
    border: none;
    background: transparent;
    color: var(--text-secondary);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 0.8rem;
  }
  
  .theme-btn.active {
    background: var(--primary);
    color: white;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    main {
      grid-template-columns: 1fr;
      padding: 20px 16px;
      gap: 20px;
    }
    
    header {
      padding: 12px 16px;
    }
    
    .header-controls {
      gap: 8px;
    }
    
    button, .btn {
      padding: 10px 16px;
      font-size: 0.8rem;
    }
    
    section.card {
      padding: 20px;
    }
    
    .fab {
      bottom: 16px;
      right: 16px;
      width: 56px;
      height: 56px;
    }
    
    .command-palette {
      width: 95%;
      margin: 0 2.5%;
    }
    
    header .title {
      font-size: 1.5rem;
    }
  }

  /* Focus States for Accessibility */
  *:focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
  }
  
  /* Reduced Motion */
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* High Contrast Mode */
  @media (prefers-contrast: high) {
    :root {
      --bg-card: #222;
      --border: #666;
      --text-primary: #fff;
    }
  }
</style>
</head>
<body>

<!-- Loading Screen -->
<div id="loader" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#000;display:flex;align-items:center;justify-content:center;z-index:99999;transition: opacity 1s ease-in-out;">
  <div style="text-align:center;">
    <div class="spinner" style="margin:0 auto 20px;"></div>
    <div style="color:#4fc3f7;font-size:1.2rem;font-weight:600;">Loading Mason Tool...</div>
  </div>
</div>

<!-- Space Background -->
<canvas id="stars-canvas"></canvas>
<canvas id="spaceship-canvas"></canvas>
<canvas id="trail-canvas"></canvas>

<!-- Command Palette -->
<div class="command-palette" id="command-palette">
  <input type="text" placeholder="Search tools... (Ctrl+K)" id="command-input">
  <div class="command-results" id="command-results"></div>
</div>

<!-- Overlay for Command Palette -->
<div id="overlay" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:999;opacity:0;visibility:hidden;transition:all 0.3s;"></div>

<header>
  <div class="title">Mason Tool</div>
  <div class="header-controls">
    <button id="select-file" title="Select Music/Video">Media</button>
    <input type="file" id="file-input" accept="audio/*,video/*" hidden />
    <div class="theme-selector">
      <button class="theme-btn active" data-theme="dark">Dark</button>
      <button class="theme-btn" data-theme="space">Space</button>
      <button class="theme-btn" data-theme="neon">Neon</button>
    </div>
    <button id="help-btn" title="Keyboard Shortcuts">Help</button>
  </div>
</header>

<main>
  <!-- Smart Notes -->
  <section class="card" data-tool="notes">
    <h2>Smart Notes</h2>
    <textarea id="notes" placeholder="Start typing... Auto-saves every 3 seconds"></textarea>
    <div style="display:flex;gap:8px;margin-top:12px;">
      <button id="save-notes">Save</button>
      <button id="export-notes">Export</button>
      <button id="import-notes">Import</button>
    </div>
    <div id="notes-status" class="status" style="display:none;"></div>
  </section>

  <!-- Text Analytics -->
  <section class="card" data-tool="word-counter">
    <h2>Text Analytics</h2>
    <textarea id="word-input" placeholder="Paste or type text here for detailed analysis..."></textarea>
    <button id="count-btn">Analyze Text</button>
    <div id="word-stats" style="margin-top:12px;display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:8px;"></div>
  </section>

  <!-- Text Encoder -->
  <section class="card" data-tool="base64">
    <h2>Text Encoder</h2>
    <textarea id="b64-input" placeholder="Enter text to encode/decode..."></textarea>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;">
      <button id="b64-encode">Base64 Encode</button>
      <button id="b64-decode">Base64 Decode</button>
      <button id="url-encode">URL Encode</button>
      <button id="url-decode">URL Decode</button>
    </div>
    <div class="output" id="b64-output" style="margin-top:12px;"></div>
    <button id="b64-copy" style="margin-top:8px;">Copy Result</button>
  </section>

  <!-- QR Code Generator -->
  <section class="card" data-tool="qr-code">
    <h2>QR Code Generator</h2>
    <input type="text" id="qr-input" placeholder="Enter text or URL...">
    <div style="display:flex;gap:8px;margin-top:12px;">
      <button id="qr-generate">Generate QR</button>
      <button id="qr-download">Download</button>
    </div>
    <div id="qr-output" style="text-align:center;margin-top:16px;"></div>
  </section>

  <!-- Color Palette -->
  <section class="card" data-tool="color-picker">
    <h2>Color Palette</h2>
    <input type="color" id="base-color" value="#4fc3f7" style="width:100%;height:50px;border:none;border-radius:8px;cursor:pointer;">
    <div style="display:flex;gap:8px;margin-top:12px;">
      <button id="generate-palette">Generate Palette</button>
      <button id="random-palette">Random</button>
    </div>
    <div id="color-palette" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(60px,1fr));gap:12px;margin-top:16px;"></div>
    <div id="color-codes" style="margin-top:12px;font-family:monospace;font-size:0.9rem;"></div>
  </section>

  <!-- Browser Info -->
  <section class="card" data-tool="browser-info">
    <h2>Browser Info</h2>
    <button id="show-info">Show Browser Info</button>
    <pre id="browser-info" style="margin-top:12px;"></pre>
  </section>

  <!-- System Info -->
  <section class="card" data-tool="system-info">
    <h2>System Info</h2>
    <button id="show-system-info">Show System Info</button>
    <pre id="system-info" style="margin-top:12px;"></pre>
  </section>

  <!-- Performance Monitor -->
  <section class="card" data-tool="performance">
    <h2>Performance Monitor</h2>
    <button id="perf-monitor">Monitor Performance</button>
    <div id="perf-stats" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px;margin-top:16px;"></div>
  </section>

  <!-- Device Info -->
  <section class="card" data-tool="device-info">
    <h2>Device Info</h2>
    <button id="show-device-info">Show Device Info</button>
    <pre id="device-info" style="margin-top:12px;"></pre>
  </section>

  <!-- Weather -->
  <section class="card" data-tool="weather">
    <h2>Weather</h2>
    <div style="display:flex;gap:8px;">
      <input id="weather-city" type="text" placeholder="City name..." style="flex:1;">
      <button id="get-weather">Get Weather</button>
      <button id="get-location-weather">Use Location</button>
    </div>
    <div id="weather-output" style="margin-top:12px;"></div>
  </section>

  <!-- Inspiration -->
  <section class="card" data-tool="quotes">
    <h2>Inspiration</h2>
    <div id="quote-text" style="font-style: italic;margin-bottom:12px;">Click for daily inspiration...</div>
    <div style="display:flex;gap:8px;">
      <button id="new-quote">New Quote</button>
      <button id="save-quote">Save Quote</button>
      <button id="share-quote">Share</button>
    </div>
    <div id="saved-quotes" style="margin-top:12px;"></div>
  </section>

  <!-- Pomodoro Timer -->
  <section class="card" data-tool="pomodoro">
    <h2>Pomodoro Timer</h2>
    <div id="pomodoro-display" style="font-size: 2rem; font-weight: 700; text-align:center; margin: 20px 0; color: var(--primary);">25:00</div>
    <div style="display:flex;gap:8px;justify-content:center;margin-bottom:12px;">
      <button id="pomodoro-start">Start</button>
      <button id="pomodoro-pause" disabled>Pause</button>
      <button id="pomodoro-reset">Reset</button>
    </div>
    <div style="display:flex;gap:8px;font-size:0.9rem;">
      <label style="flex:1;">Work: <input type="number" id="work-time" value="25" min="1" max="60" style="width:60px;"></label>
      <label style="flex:1;">Break: <input type="number" id="break-time" value="5" min="1" max="30" style="width:60px;"></label>
    </div>
    <div id="pomo-stats" style="margin-top:12px;font-size:0.9rem;color:var(--text-secondary);"></div>
  </section>

  <!-- Calculator -->
  <section class="card" data-tool="calculator">
    <h2>Calculator</h2>
    <input id="calc-display" readonly value="0" style="text-align:right;font-size:1.5rem;font-weight:700;" />
    <div class="calc-buttons">
      <button data-val="C" style="background:var(--error);">C</button>
      <button data-val="±">±</button>
      <button data-val="%">%</button>
      <button data-val="/" style="background:var(--primary);">÷</button>
      <button data-val="7">7</button>
      <button data-val="8">8</button>
      <button data-val="9">9</button>
      <button data-val="*" style="background:var(--primary);">×</button>
      <button data-val="4">4</button>
      <button data-val="5">5</button>
      <button data-val="6">6</button>
      <button data-val="-" style="background:var(--primary);">−</button>
      <button data-val="1">1</button>
      <button data-val="2">2</button>
      <button data-val="3">3</button>
      <button data-val="+" style="background:var(--primary);">+</button>
      <button data-val="0" style="grid-column:span 2;">0</button>
      <button data-val=".">.</button>
      <button id="calc-equal" style="background:var(--success);">=</button>
    </div>
    <div id="calc-history" style="margin-top:12px;max-height:100px;overflow-y:auto;font-size:0.8rem;color:var(--text-secondary);"></div>
  </section>

  <!-- Currency Converter -->
  <section class="card" data-tool="currency">
    <h2>Currency Converter</h2>
    <div style="display:grid;grid-template-columns:1fr auto 1fr;gap:12px;align-items:end;">
      <div>
        <label>From:</label>
        <select id="from-currency"></select>
        <input type="number" id="amount" min="0" value="1" placeholder="Amount">
      </div>
      <button id="swap-currencies" style="width:40px;height:40px;border-radius:50%;font-size:1.2rem;" title="Swap currencies">⇄</button>
      <div>
        <label>To:</label>
        <select id="to-currency"></select>
        <div id="converted-amount" style="font-size:1.2rem;font-weight:700;color:var(--primary);margin-top:8px;">-</div>
      </div>
    </div>
    <button id="convert-btn" style="margin-top:12px;width:100%;">Convert</button>
    <div id="currency-result" style="margin-top:12px;"></div>
    <div id="exchange-rate" style="margin-top:8px;font-size:0.9rem;color:var(--text-secondary);"></div>
  </section>

  <!-- Crypto Tracker -->
  <section class="card" data-tool="crypto">
    <h2>Crypto Tracker</h2>
    <button id="refresh-crypto">Refresh Prices</button>
    <div id="crypto-ticker" style="display:flex;gap:16px;overflow-x:auto;padding:16px 0;scrollbar-width:none;"></div>
  </section>

  <!-- IP & Location -->
  <section class="card" data-tool="ip-info">
    <h2>IP & Location</h2>
    <button id="ip-review-btn" style="background:var(--error); color:#fff;">Reveal My IP</button>
    <div id="ip-result" style="margin-top:12px;"></div>
    <div id="location-info" style="margin-top:8px;font-size:0.9rem;"></div>
  </section>

  <!-- Password Generator -->
  <section class="card" data-tool="password">
    <h2>Password Generator</h2>
    <div class="pw-controls">
      <label>Length:</label>
      <input type="number" id="pw-length" min="6" max="128" value="16">
      <button id="pw-generate">Generate</button>
      <button id="pw-copy" title="Copy password">Copy</button>
    </div>
    <div style="display:flex;gap:12px;margin:8px 0;font-size:0.9rem;">
      <label><input type="checkbox" id="pw-uppercase" checked> ABC</label>
      <label><input type="checkbox" id="pw-lowercase" checked> abc</label>
      <label><input type="checkbox" id="pw-numbers" checked> 123</label>
      <label><input type="checkbox" id="pw-symbols" checked> !@#</label>
    </div>
    <div class="pw-output" id="pw-output">Click generate for secure password</div>
    <div id="pw-strength" style="margin-top:8px;"></div>
  </section>

  <!-- Smart Tasks -->
  <section class="card" data-tool="tasks">
    <h2>Smart Tasks</h2>
    <div style="display:flex;gap:8px;margin-bottom:12px;">
      <input type="text" id="task-input" placeholder="Add new task..." style="flex:1;">
      <select id="task-priority">
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
      </select>
      <button id="task-add-btn">Add</button>
    </div>
    <div style="display:flex;gap:8px;margin-bottom:12px;">
      <button id="filter-all" class="active">All</button>
      <button id="filter-pending">Pending</button>
      <button id="filter-completed">Completed</button>
      <button id="clear-completed">Clear Done</button>
    </div>
    <ul id="task-list" style="list-style:none;padding:0;"></ul>
    <div id="task-stats" style="margin-top:12px;font-size:0.9rem;color:var(--text-secondary);"></div>
  </section>
</main>

<!-- Floating Action Button -->
<button class="fab" id="fab-main" title="Quick Actions">⚡</button>

<!-- Quick Actions Menu -->
<div id="fab-menu" style="position:fixed;bottom:100px;right:24px;display:flex;flex-direction:column;gap:12px;opacity:0;visibility:hidden;transition:all 0.3s;z-index:49;">
  <button class="fab" style="width:48px;height:48px;font-size:1.2rem;" id="fab-theme" title="Toggle Theme">🌙</button>
  <button class="fab" style="width:48px;height:48px;font-size:1.2rem;" id="fab-export" title="Export Data">💾</button>
  <button class="fab" style="width:48px;height:48px;font-size:1.2rem;" id="fab-fullscreen" title="Fullscreen">⛶</button>
</div>

<footer>
  <div style="display:flex;justify-content:center;align-items:center;gap:16px;flex-wrap:wrap;">
    <span>Made by Mason with ❤️ — Ultimate Multi Purpose Tool 2025</span>
    <div style="display:flex;gap:8px;">
      <span id="tools-count">0 tools loaded</span>
      <span>•</span>
      <span id="online-status">🟢 Online</span>
      <span>•</span>
      <span id="last-save">Auto-saved</span>
    </div>
  </div>
  <div style="margin-top:12px;font-size:0.8rem;color:var(--text-secondary);">
    Find me for ideas and feedback: <strong id="discord-username" style="color:var(--primary);cursor:pointer;" title="Click to copy">masondaking0542</strong> on Discord
  </div>
</footer>

<script>
// Wait for DOM to be fully loaded
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM Content Loaded');
  
  // Initialize the application
  initializeApp();
});

function initializeApp() {
  console.log('Initializing Mason Tool...');
  
  // Hide loader after a short delay to ensure everything is ready
  setTimeout(() => {
    const loader = document.getElementById('loader');
    if (loader) {
      loader.style.opacity = '0';
      setTimeout(() => {
        loader.style.display = 'none';
        console.log('Loader hidden');
      }, 500);
    }
  }, 1500);

  // Initialize space background
  initializeSpaceBackground();
  
  // Initialize all tools
  initializeTools();
  
  // Setup event listeners
  setupEventListeners();
  
  console.log('Mason Tool initialized successfully!');
}

function initializeSpaceBackground() {
  try {
    const starsCanvas = document.getElementById('stars-canvas');
    const shipCanvas = document.getElementById('spaceship-canvas');
    const trailCanvas = document.getElementById('trail-canvas');
    
    if (!starsCanvas || !shipCanvas || !trailCanvas) {
      console.warn('Canvas elements not found, skipping space background');
      return;
    }

    const starsCtx = starsCanvas.getContext('2d');
    const shipCtx = shipCanvas.getContext('2d');
    const trailCtx = trailCanvas.getContext('2d');

    let width, height;
    
    function resizeCanvas() {
      width = window.innerWidth;
      height = window.innerHeight;
      [starsCanvas, shipCanvas, trailCanvas].forEach(c => {
        c.width = width;
        c.height = height;
      });
    }
    
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // Stars
    const stars = [];
    const maxStars = Math.min(80, Math.floor(width * height / 15000)); // Reduced for performance
    
    function createStars() {
      stars.length = 0;
      for(let i = 0; i < maxStars; i++) {
        stars.push({
          x: Math.random() * width,
          y: Math.random() * height,
          size: Math.random() * 1.5 + 0.5,
          alpha: Math.random() * 0.8 + 0.2,
          speed: 0.1 + Math.random() * 0.15,
        });
      }
    }
    createStars();

    function drawStars() {
      starsCtx.clearRect(0, 0, width, height);
      starsCtx.fillStyle = 'white';
      
      stars.forEach(star => {
        starsCtx.globalAlpha = star.alpha;
        starsCtx.beginPath();
        starsCtx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
        starsCtx.fill();
        
        star.x -= star.speed;
        if (star.x < -10) {
          star.x = width + 10;
          star.y = Math.random() * height;
        }
      });
      starsCtx.globalAlpha = 1;
    }

    // Simple animation loop
    function animate() {
      drawStars();
      requestAnimationFrame(animate);
    }
    
    // Start animation
    requestAnimationFrame(animate);
    
    console.log('Space background initialized');
  } catch (error) {
    console.error('Error initializing space background:', error);
  }
}

function initializeTools() {
  // Initialize tools count
  const toolsCount = document.querySelectorAll('.card').length;
  const toolsCountEl = document.getElementById('tools-count');
  if (toolsCountEl) {
    toolsCountEl.textContent = `${toolsCount} tools loaded`;
  }

  // Load saved notes
  try {
    const savedNotes = localStorage.getItem('masonNotes');
    const notesEl = document.getElementById('notes');
    if (savedNotes && notesEl) {
      notesEl.value = savedNotes;
    }
  } catch (e) {
    console.log('Could not load saved notes');
  }

  // Initialize currency selectors
  initializeCurrencySelectors();
  
  // Initialize tasks
  initializeTasks();
  
  // Initialize pomodoro display
  updatePomoDisplay();
  
  console.log('Tools initialized');
}

function setupEventListeners() {
  // Discord username copy
  const discordUsername = document.getElementById('discord-username');
  if (discordUsername) {
    discordUsername.addEventListener('click', function() {
      const username = this.textContent;
      navigator.clipboard.writeText(username).then(() => {
        showToast('Discord username copied!', 'success');
      }).catch(() => {
        showToast('Failed to copy username', 'error');
      });
    });
  }

  // Media file selection
  const selectFileBtn = document.getElementById('select-file');
  const fileInput = document.getElementById('file-input');
  
  if (selectFileBtn && fileInput) {
    selectFileBtn.addEventListener('click', () => {
      fileInput.click();
    });

    fileInput.addEventListener('change', handleFileSelection);
  }

  // Notes auto-save
  const notesEl = document.getElementById('notes');
  if (notesEl) {
    let notesTimeout;
    notesEl.addEventListener('input', () => {
      clearTimeout(notesTimeout);
      notesTimeout = setTimeout(() => {
        try {
          localStorage.setItem('masonNotes', notesEl.value);
          showNotesStatus('Auto-saved', 'success');
          updateLastSave();
        } catch (e) {
          showNotesStatus('Save failed', 'error');
        }
      }, 3000);
    });
  }

  // Setup all button event listeners
  setupButtonEventListeners();
  
  console.log('Event listeners setup complete');
}

function setupButtonEventListeners() {
  // Notes buttons
  const saveNotesBtn = document.getElementById('save-notes');
  if (saveNotesBtn) {
    saveNotesBtn.onclick = () => {
      const notesEl = document.getElementById('notes');
      try {
        localStorage.setItem('masonNotes', notesEl.value);
        showToast('Notes saved successfully!');
        updateLastSave();
      } catch (e) {
        showToast('Failed to save notes', 'error');
      }
    };
  }

  // Export notes
  const exportNotesBtn = document.getElementById('export-notes');
  if (exportNotesBtn) {
    exportNotesBtn.onclick = () => {
      const notesEl = document.getElementById('notes');
      const text = notesEl.value;
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `mason-notes-${new Date().toISOString().split('T')[0]}.txt`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('Notes exported!');
    };
  }

  // Word counter
  const countBtn = document.getElementById('count-btn');
  if (countBtn) {
    countBtn.onclick = () => {
      const text = document.getElementById('word-input').value.trim();
      analyzeText(text);
    };
  }

  // Base64 encoder/decoder
  setupBase64Handlers();
  
  // Password generator
  setupPasswordGenerator();
  
  // Calculator
  setupCalculator();
  
  // Browser/System info
  setupInfoButtons();
  
  // Color palette
  setupColorPalette();
  
  // Pomodoro timer
  setupPomodoroTimer();
  
  // Quotes
  setupQuotes();
  
  // IP info
  setupIPInfo();
  
  // Placeholder buttons
  setupPlaceholderButtons();
}

function handleFileSelection(event) {
  const file = event.target.files[0];
  if (!file) return;

  const fileSize = (file.size / 1024 / 1024).toFixed(2);
  
  if (file.type.startsWith('audio/')) {
    showToast(`Audio file selected: ${file.name} (${fileSize} MB)`, 'success');
    createMediaPlayer(file, 'audio');
  } else if (file.type.startsWith('video/')) {
    showToast(`Video file selected: ${file.name} (${fileSize} MB)`, 'success');
    createMediaPlayer(file, 'video');
  } else {
    showToast('Please select an audio or video file', 'warning');
  }
}

function createMediaPlayer(file, type) {
  const player = document.createElement(type);
  player.controls = true;
  player.style.cssText = 'width: 100%; margin-top: 12px; border-radius: 8px;';
  if (type === 'video') {
    player.style.maxHeight = '300px';
  }
  player.src = URL.createObjectURL(file);
  
  const notesSection = document.querySelector('[data-tool="notes"]');
  const existingPlayer = notesSection.querySelector('audio, video');
  if (existingPlayer) existingPlayer.remove();
  
  notesSection.appendChild(player);
}

function analyzeText(text) {
  const words = text ? text.split(/\s+/).filter(w => w).length : 0;
  const chars = text.length;
  const sentences = text ? text.split(/[.!?]+/).filter(s => s.trim()).length : 0;
  const paragraphs = text ? text.split(/\n\s*\n/).filter(p => p.trim()).length : 0;
  const readingTime = Math.ceil(words / 200);
  
  const statsEl = document.getElementById('word-stats');
  statsEl.innerHTML = `
    <div style="background:rgba(255,255,255,0.05);padding:12px;border-radius:8px;text-align:center;">
      <div style="font-size:1.2rem;font-weight:700;color:var(--primary);">${words}</div>
      <div style="font-size:0.8rem;color:var(--text-secondary);">Words</div>
    </div>
    <div style="background:rgba(255,255,255,0.05);padding:12px;border-radius:8px;text-align:center;">
      <div style="font-size:1.2rem;font-weight:700;color:var(--primary);">${chars}</div>
      <div style="font-size:0.8rem;color:var(--text-secondary);">Characters</div>
    </div>
    <div style="background:rgba(255,255,255,0.05);padding:12px;border-radius:8px;text-align:center;">
      <div style="font-size:1.2rem;font-weight:700;color:var(--primary);">${sentences}</div>
      <div style="font-size:0.8rem;color:var(--text-secondary);">Sentences</div>
    </div>
    <div style="background:rgba(255,255,255,0.05);padding:12px;border-radius:8px;text-align:center;">
      <div style="font-size:1.2rem;font-weight:700;color:var(--primary);">${readingTime}m</div>
      <div style="font-size:0.8rem;color:var(--text-secondary);">Read Time</div>
    </div>
  `;
  showToast('Text analysis complete!');
}

function setupBase64Handlers() {
  const b64In = document.getElementById('b64-input');
  const b64Out = document.getElementById('b64-output');
  
  document.getElementById('b64-encode').onclick = () => {
    try {
      b64Out.textContent = btoa(unescape(encodeURIComponent(b64In.value)));
      showToast('Text encoded to Base64!');
    } catch {
      b64Out.textContent = 'Error: Invalid input';
      showToast('Encoding failed', 'error');
    }
  };
  
  document.getElementById('b64-decode').onclick = () => {
    try {
      b64Out.textContent = decodeURIComponent(escape(atob(b64In.value)));
      showToast('Base64 decoded!');
    } catch {
      b64Out.textContent = 'Error: Invalid Base64';
      showToast('Decoding failed - invalid Base64', 'error');
    }
  };

  document.getElementById('url-encode').onclick = () => {
    try {
      b64Out.textContent = encodeURIComponent(b64In.value);
      showToast('Text URL encoded!');
    } catch {
      b64Out.textContent = 'Error: Invalid input';
      showToast('URL encoding failed', 'error');
    }
  };

  document.getElementById('url-decode').onclick = () => {
    try {
      b64Out.textContent = decodeURIComponent(b64In.value);
      showToast('URL decoded!');
    } catch {
      b64Out.textContent = 'Error: Invalid URL encoding';
      showToast('URL decoding failed', 'error');
    }
  };

  document.getElementById('b64-copy').onclick = () => {
    if (b64Out.textContent && !b64Out.textContent.startsWith('Error')) {
      navigator.clipboard.writeText(b64Out.textContent);
      showToast('Copied to clipboard!');
    } else {
      showToast('Nothing to copy', 'warning');
    }
  };
}

function setupPasswordGenerator() {
  document.getElementById('pw-generate').onclick = () => {
    const length = parseInt(document.getElementById('pw-length').value);
    const uppercase = document.getElementById('pw-uppercase').checked;
    const lowercase = document.getElementById('pw-lowercase').checked;
    const numbers = document.getElementById('pw-numbers').checked;
    const symbols = document.getElementById('pw-symbols').checked;
    
    let charset = '';
    if (uppercase) charset += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    if (lowercase) charset += 'abcdefghijklmnopqrstuvwxyz';
    if (numbers) charset += '0123456789';
    if (symbols) charset += '!@#$%^&*()_+-=[]{}|;:,.<>?';
    
    if (!charset) {
      showToast('Please select at least one character type', 'warning');
      return;
    }
    
    let password = '';
    for (let i = 0; i < length; i++) {
      password += charset.charAt(Math.floor(Math.random() * charset.length));
    }
    
    document.getElementById('pw-output').textContent = password;
    calculatePasswordStrength(charset, length);
    showToast('Secure password generated!');
  };

  document.getElementById('pw-copy').onclick = () => {
    const password = document.getElementById('pw-output').textContent;
    if (password && password !== 'Click generate for secure password') {
      navigator.clipboard.writeText(password);
      showToast('Password copied to clipboard!');
    } else {
      showToast('Generate a password first', 'warning');
    }
  };
}

function calculatePasswordStrength(charset, length) {
  const entropy = Math.log2(Math.pow(charset.length, length));
  let strengthText = '';
  let strengthColor = '';
  
  if (entropy < 28) {
    strengthText = 'Very Weak';
    strengthColor = '#f44336';
  } else if (entropy < 36) {
    strengthText = 'Weak';
    strengthColor = '#ff9800';
  } else if (entropy < 60) {
    strengthText = 'Fair';
    strengthColor = '#ffeb3b';
  } else if (entropy < 128) {
    strengthText = 'Strong';
    strengthColor = '#8bc34a';
  } else {
    strengthText = 'Very Strong';
    strengthColor = '#4caf50';
  }
  
  document.getElementById('pw-strength').innerHTML = `
    <div style="color: ${strengthColor}; font-weight: 600;">
      Strength: ${strengthText} (${Math.floor(entropy)} bits of entropy)
    </div>
  `;
}

function setupCalculator() {
  let calcDisplay = document.getElementById('calc-display');
  let calcValue = '0';
  let calcOperator = null;
  let calcOperand = null;
  let calcWaitingForOperand = false;
  let calcHistory = [];

  function updateCalcDisplay() {
    if (calcDisplay) {
      calcDisplay.value = calcValue;
    }
  }

  function inputCalcDigit(digit) {
    if (calcWaitingForOperand) {
      calcValue = digit;
      calcWaitingForOperand = false;
    } else {
      calcValue = calcValue === '0' ? digit : calcValue + digit;
    }
  }

  function inputCalcOperator(nextOperator) {
    const inputValue = parseFloat(calcValue);

    if (calcOperand === null) {
      calcOperand = inputValue;
    } else if (calcOperator) {
      const currentValue = calcOperand || 0;
      const newValue = calculate(currentValue, inputValue, calcOperator);

      calcValue = String(newValue);
      calcOperand = newValue;
      
      calcHistory.push(`${currentValue} ${calcOperator} ${inputValue} = ${newValue}`);
      updateCalcHistory();
    }

    calcWaitingForOperand = true;
    calcOperator = nextOperator;
  }

  function calculate(firstOperand, secondOperand, operator) {
    switch (operator) {
      case '+': return firstOperand + secondOperand;
      case '-': return firstOperand - secondOperand;
      case '*': return firstOperand * secondOperand;
      case '/': return secondOperand !== 0 ? firstOperand / secondOperand : 0;
      case '%': return firstOperand % secondOperand;
      case '=': return secondOperand;
      default: return secondOperand;
    }
  }

  function updateCalcHistory() {
    const historyEl = document.getElementById('calc-history');
    if (historyEl) {
      historyEl.innerHTML = calcHistory.slice(-3).map(entry => `<div>${entry}</div>`).join('');
    }
  }

  // Calculator button event listeners
  document.querySelectorAll('.calc-buttons button').forEach(button => {
    button.addEventListener('click', (e) => {
      const value = button.dataset.val;
      
      if (!isNaN(value) || value === '.') {
        inputCalcDigit(value);
        updateCalcDisplay();
      } else if (value === 'C') {
        calcValue = '0';
        calcOperator = null;
        calcOperand = null;
        calcWaitingForOperand = false;
        updateCalcDisplay();
      } else if (value === '±') {
        calcValue = String(parseFloat(calcValue) * -1);
        updateCalcDisplay();
      } else {
        inputCalcOperator(value);
        updateCalcDisplay();
      }
    });
  });

  const calcEqualBtn = document.getElementById('calc-equal');
  if (calcEqualBtn) {
    calcEqualBtn.addEventListener('click', () => {
      const inputValue = parseFloat(calcValue);

      if (calcOperand !== null && calcOperator) {
        const newValue = calculate(calcOperand, inputValue, calcOperator);
        
        calcHistory.push(`${calcOperand} ${calcOperator} ${inputValue} = ${newValue}`);
        updateCalcHistory();
        
        calcValue = String(newValue);
        calcOperand = null;
        calcOperator = null;
        calcWaitingForOperand = true;
        updateCalcDisplay();
      }
    });
  }
}

function setupInfoButtons() {
  // Browser info
  const showInfoBtn = document.getElementById('show-info');
  if (showInfoBtn) {
    showInfoBtn.onclick = () => {
      const info = {
        'User Agent': navigator.userAgent,
        'Platform': navigator.platform,
        'Language': navigator.language,
        'Screen Resolution': `${screen.width} x ${screen.height}`,
        'Viewport': `${window.innerWidth} x ${window.innerHeight}`,
        'Color Depth': `${screen.colorDepth}-bit`,
        'Time Zone': Intl.DateTimeFormat().resolvedOptions().timeZone,
        'Online': navigator.onLine ? 'Yes' : 'No',
        'Cookies Enabled': navigator.cookieEnabled ? 'Yes' : 'No'
      };
      
      document.getElementById('browser-info').textContent = 
        Object.entries(info).map(([key, value]) => `${key}: ${value}`).join('\n');
      showToast('Browser info loaded!');
    };
  }

  // System info
  const showSystemInfoBtn = document.getElementById('show-system-info');
  if (showSystemInfoBtn) {
    showSystemInfoBtn.onclick = () => {
      const info = {
        'Browser': navigator.userAgent.split(' ')[0],
        'Platform': navigator.platform,
        'CPU Cores': navigator.hardwareConcurrency || 'Unknown',
        'Memory': navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'Unknown',
        'Connection': navigator.connection ? navigator.connection.effectiveType : 'Unknown',
        'Touch Support': 'ontouchstart' in window ? 'Yes' : 'No',
        'Clipboard API': navigator.clipboard ? 'Supported' : 'Not supported',
        'Geolocation': navigator.geolocation ? 'Supported' : 'Not supported'
      };
      
      document.getElementById('system-info').textContent = 
        Object.entries(info).map(([key, value]) => `${key}: ${value}`).join('\n');
      showToast('System info loaded!');
    };
  }

  // Device info
  const showDeviceInfoBtn = document.getElementById('show-device-info');
  if (showDeviceInfoBtn) {
    showDeviceInfoBtn.onclick = () => {
      const info = {
        'Device Type': /Mobi|Android/i.test(navigator.userAgent) ? 'Mobile' : 'Desktop',
        'Screen Size': `${screen.width} x ${screen.height}`,
        'Pixel Ratio': window.devicePixelRatio,
        'Orientation': screen.orientation ? screen.orientation.type : 'Unknown',
        'Battery API': 'getBattery' in navigator ? 'Supported' : 'Not supported',
        'Vibration': 'vibrate' in navigator ? 'Supported' : 'Not supported',
        'WebGL': getWebGLSupport(),
        'Local Storage': 'localStorage' in window ? 'Supported' : 'Not supported'
      };
      
      document.getElementById('device-info').textContent = 
        Object.entries(info).map(([key, value]) => `${key}: ${value}`).join('\n');
      showToast('Device info loaded!');
    };
  }

  // Performance monitor
  const perfMonitorBtn = document.getElementById('perf-monitor');
  if (perfMonitorBtn) {
    perfMonitorBtn.onclick = () => {
      const startTime = performance.now();
      
      // Simple performance test
      let result = 0;
      for (let i = 0; i < 100000; i++) {
        result += Math.random();
      }
      
      const endTime = performance.now();
      const executionTime = (endTime - startTime).toFixed(2);
      
      const stats = {
        'Execution Time': `${executionTime}ms`,
        'Memory Used': `${(performance.memory ? (performance.memory.usedJSHeapSize / 1048576).toFixed(2) : 'Unknown')} MB`,
        'Total Memory': `${(performance.memory ? (performance.memory.totalJSHeapSize / 1048576).toFixed(2) : 'Unknown')} MB`,
        'Page Load': `${performance.timing ? (performance.timing.loadEventEnd - performance.timing.navigationStart) : 'Unknown'}ms`,
        'DOM Ready': `${performance.timing ? (performance.timing.domContentLoadedEventEnd - performance.timing.navigationStart) : 'Unknown'}ms`
      };

      const statsEl = document.getElementById('perf-stats');
      statsEl.innerHTML = Object.entries(stats).map(([label, value]) => `
        <div style="background:rgba(255,255,255,0.05);padding:12px;border-radius:8px;text-align:center;border:1px solid var(--glass-border);">
          <div style="font-size:1.2rem;font-weight:700;color:var(--primary);margin-bottom:4px;">${value}</div>
          <div style="font-size:0.8rem;color:var(--text-secondary);">${label}</div>
        </div>
      `).join('');

      showToast('Performance analysis complete!');
    };
  }
}

function getWebGLSupport() {
  try {
    const canvas = document.createElement('canvas');
    return !!(window.WebGLRenderingContext && canvas.getContext('webgl')) ? 'Supported' : 'Not supported';
  } catch (e) {
    return 'Not supported';
  }
}

function setupColorPalette() {
  document.getElementById('generate-palette').onclick = () => {
    const baseColor = document.getElementById('base-color').value;
    const colors = generateColorPalette(baseColor);
    displayColorPalette(colors);
  };

  document.getElementById('random-palette').onclick = () => {
    const randomColor = '#' + Math.floor(Math.random()*16777215).toString(16);
    document.getElementById('base-color').value = randomColor;
    const colors = generateColorPalette(randomColor);
    displayColorPalette(colors);
  };
}

function generateColorPalette(baseColor) {
  const colors = [baseColor];
  const hsl = hexToHsl(baseColor);
  
  // Generate complementary and analogous colors
  for (let i = 1; i < 6; i++) {
    const newHue = (hsl[0] + (i * 60)) % 360;
    const newColor = hslToHex(newHue, hsl[1], hsl[2]);
    colors.push(newColor);
  }
  
  return colors;
}

function displayColorPalette(colors) {
  const paletteEl = document.getElementById('color-palette');
  paletteEl.innerHTML = colors.map(color => `
    <div style="height:60px;border-radius:12px;cursor:pointer;transition:all 0.3s;position:relative;border:2px solid transparent;background-color:${color};" 
         onclick="copyColor('${color}')" 
         title="Click to copy ${color}">
    </div>
  `).join('');
  
  document.getElementById('color-codes').innerHTML = colors.map(color => color).join(' • ');
  showToast('Color palette generated!');
}

function copyColor(color) {
  navigator.clipboard.writeText(color);
  showToast(`Color ${color} copied!`);
}

function hexToHsl(hex) {
  const r = parseInt(hex.slice(1, 3), 16) / 255;
  const g = parseInt(hex.slice(3, 5), 16) / 255;
  const b = parseInt(hex.slice(5, 7), 16) / 255;

  const max = Math.max(r, g, b);
  const min = Math.min(r, g, b);
  let h, s, l = (max + min) / 2;

  if (max === min) {
    h = s = 0;
  } else {
    const d = max - min;
    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
    switch (max) {
      case r: h = (g - b) / d + (g < b ? 6 : 0); break;
      case g: h = (b - r) / d + 2; break;
      case b: h = (r - g) / d + 4; break;
    }
    h /= 6;
  }

  return [h * 360, s, l];
}

function hslToHex(h, s, l) {
  h /= 360;
  const a = s * Math.min(l, 1 - l);
  const f = n => {
    const k = (n + h * 12) % 12;
    const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
    return Math.round(255 * color).toString(16).padStart(2, '0');
  };
  return `#${f(0)}${f(8)}${f(4)}`;
}

function setupPomodoroTimer() {
  let pomoTimer = null;
  let pomoSeconds = 25 * 60;
  let pomoIsBreak = false;
  let pomoSessions = 0;

  function updatePomoDisplay() {
    const minutes = Math.floor(pomoSeconds / 60);
    const seconds = pomoSeconds % 60;
    const displayEl = document.getElementById('pomodoro-display');
    if (displayEl) {
      displayEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }
  }

  document.getElementById('pomodoro-start').onclick = () => {
    if (pomoTimer) return;
    
    pomoTimer = setInterval(() => {
      pomoSeconds--;
      updatePomoDisplay();
      
      if (pomoSeconds <= 0) {
        clearInterval(pomoTimer);
        pomoTimer = null;
        
        if (!pomoIsBreak) {
          pomoSessions++;
          pomoSeconds = parseInt(document.getElementById('break-time').value) * 60;
          pomoIsBreak = true;
          showToast('Work session complete! Take a break.');
        } else {
          pomoSeconds = parseInt(document.getElementById('work-time').value) * 60;
          pomoIsBreak = false;
          showToast('Break over! Back to work.');
        }
        
        updatePomoDisplay();
        document.getElementById('pomodoro-start').disabled = false;
        document.getElementById('pomodoro-pause').disabled = true;
        
        const statsEl = document.getElementById('pomo-stats');
        if (statsEl) {
          statsEl.textContent = `Sessions completed: ${pomoSessions}`;
        }
      }
    }, 1000);
    
    document.getElementById('pomodoro-start').disabled = true;
    document.getElementById('pomodoro-pause').disabled = false;
  };

  document.getElementById('pomodoro-pause').onclick = () => {
    if (pomoTimer) {
      clearInterval(pomoTimer);
      pomoTimer = null;
      document.getElementById('pomodoro-start').disabled = false;
      document.getElementById('pomodoro-pause').disabled = true;
      showToast('Timer paused');
    }
  };

  document.getElementById('pomodoro-reset').onclick = () => {
    if (pomoTimer) {
      clearInterval(pomoTimer);
      pomoTimer = null;
    }
    
    pomoSeconds = parseInt(document.getElementById('work-time').value) * 60;
    pomoIsBreak = false;
    updatePomoDisplay();
    
    document.getElementById('pomodoro-start').disabled = false;
    document.getElementById('pomodoro-pause').disabled = true;
    showToast('Timer reset');
  };

  // Make updatePomoDisplay available globally
  window.updatePomoDisplay = updatePomoDisplay;
}

function setupQuotes() {
  const quotes = [
    "The only way to do great work is to love what you do. - Steve Jobs",
    "Life is what happens to you while you're busy making other plans. - John Lennon",
    "The future belongs to those who believe in the beauty of their dreams. - Eleanor Roosevelt",
    "It is during our darkest moments that we must focus to see the light. - Aristotle",
    "The only impossible journey is the one you never begin. - Tony Robbins",
    "Success is not final, failure is not fatal: it is the courage to continue that counts. - Winston Churchill",
    "Believe you can and you're halfway there. - Theodore Roosevelt",
    "The best time to plant a tree was 20 years ago. The second best time is now. - Chinese Proverb",
    "Your limitation—it's only your imagination.",
    "Push yourself, because no one else is going to do it for you."
  ];

  document.getElementById('new-quote').onclick = () => {
    const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
    document.getElementById('quote-text').textContent = randomQuote;
    showToast('New inspiration loaded!');
  };

  document.getElementById('save-quote').onclick = () => {
    showToast('Quote saving feature coming soon!', 'warning');
  };

  document.getElementById('share-quote').onclick = () => {
    const quote = document.getElementById('quote-text').textContent;
    if (navigator.share) {
      navigator.share({
        title: 'Inspirational Quote',
        text: quote
      });
    } else {
      navigator.clipboard.writeText(quote);
      showToast('Quote copied to clipboard!');
    }
  };
}

function setupIPInfo() {
  document.getElementById('ip-review-btn').onclick = async () => {
    try {
      const response = await fetch('https://api.ipify.org?format=json');
      const data = await response.json();
      
      document.getElementById('ip-result').innerHTML = `
        <div style="font-size:1.2rem;font-weight:700;color:var(--primary);margin-bottom:8px;">
          Your IP Address: ${data.ip}
        </div>
      `;
      
      document.getElementById('location-info').textContent = 'Location info unavailable (requires API key)';
      showToast('IP information retrieved!');
    } catch (error) {
      document.getElementById('ip-result').textContent = 'Unable to fetch IP information';
      showToast('Failed to get IP info', 'error');
    }
  };
}

function initializeCurrencySelectors() {
  const currencies = ['USD', 'EUR', 'GBP', 'JPY', 'AUD', 'CAD', 'CHF', 'CNY', 'SEK', 'NZD'];
  const fromCurrency = document.getElementById('from-currency');
  const toCurrency = document.getElementById('to-currency');
  
  if (fromCurrency && toCurrency) {
    currencies.forEach(currency => {
      fromCurrency.innerHTML += `<option value="${currency}">${currency}</option>`;
      toCurrency.innerHTML += `<option value="${currency}">${currency}</option>`;
    });
    
    fromCurrency.value = 'USD';
    toCurrency.value = 'EUR';
  }
}

function setupPlaceholderButtons() {
  // QR Code
  const qrGenerateBtn = document.getElementById('qr-generate');
  if (qrGenerateBtn) {
    qrGenerateBtn.onclick = () => {
      showToast('QR Code generation coming soon!', 'warning');
    };
  }

  // Currency converter
  const convertBtn = document.getElementById('convert-btn');
  if (convertBtn) {
    convertBtn.onclick = () => {
      showToast('Currency conversion API coming soon!', 'warning');
    };
  }

  // Crypto tracker
  const refreshCryptoBtn = document.getElementById('refresh-crypto');
  if (refreshCryptoBtn) {
    refreshCryptoBtn.onclick = () => {
      showToast('Crypto tracking API coming soon!', 'warning');
    };
  }

  // Weather
  const getWeatherBtn = document.getElementById('get-weather');
  if (getWeatherBtn) {
    getWeatherBtn.onclick = () => {
      showToast('Weather API coming soon!', 'warning');
    };
  }

  const getLocationWeatherBtn = document.getElementById('get-location-weather');
  if (getLocationWeatherBtn) {
    getLocationWeatherBtn.onclick = () => {
      showToast('Location weather coming soon!', 'warning');
    };
  }

  // Help button
  const helpBtn = document.getElementById('help-btn');
  if (helpBtn) {
    helpBtn.onclick = () => {
      showToast('Keyboard shortcuts: Ctrl+K for command palette', 'success');
    };
  }
}

// Task Management
let tasks = [];
let taskFilter = 'all';

function initializeTasks() {
  try {
    tasks = JSON.parse(localStorage.getItem('masonTasks') || '[]');
  } catch (e) {
    tasks = [];
  }
  
  setupTaskEventListeners();
  renderTasks();
}

function setupTaskEventListeners() {
  // Add task
  const taskAddBtn = document.getElementById('task-add-btn');
  const taskInput = document.getElementById('task-input');
  
  if (taskAddBtn) {
    taskAddBtn.onclick = addTask;
  }
  
  if (taskInput) {
    taskInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') addTask();
    });
  }

  // Filter buttons
  document.getElementById('filter-all').onclick = () => setTaskFilter('all');
  document.getElementById('filter-pending').onclick = () => setTaskFilter('pending');
  document.getElementById('filter-completed').onclick = () => setTaskFilter('completed');
  
  // Clear completed
  const clearCompletedBtn = document.getElementById('clear-completed');
  if (clearCompletedBtn) {
    clearCompletedBtn.onclick = () => {
      tasks = tasks.filter(t => !t.completed);
      saveTasks();
      renderTasks();
      showToast('Completed tasks cleared');
    };
  }
}

function addTask() {
  const input = document.getElementById('task-input');
  const priority = document.getElementById('task-priority').value;
  const text = input.value.trim();
  
  if (!text) return;
  
  tasks.push({
    id: Date.now(),
    text: text,
    priority: priority,
    completed: false,
    created: new Date().toLocaleDateString()
  });
  
  input.value = '';
  saveTasks();
  renderTasks();
  showToast('Task added!');
}

function toggleTask(id) {
  const task = tasks.find(t => t.id === id);
  if (task) {
    task.completed = !task.completed;
    saveTasks();
    renderTasks();
    showToast(task.completed ? 'Task completed!' : 'Task reopened');
  }
}

function deleteTask(id) {
  tasks = tasks.filter(t => t.id !== id);
  saveTasks();
  renderTasks();
  showToast('Task deleted');
}

function setTaskFilter(filter) {
  taskFilter = filter;
  document.querySelectorAll('#filter-all, #filter-pending, #filter-completed').forEach(btn => 
    btn.classList.remove('active'));
  document.getElementById(`filter-${filter}`).classList.add('active');
  renderTasks();
}

function saveTasks() {
  try {
    localStorage.setItem('masonTasks', JSON.stringify(tasks));
  } catch (e) {
    console.log('Could not save tasks');
  }
}

function renderTasks() {
  const taskList = document.getElementById('task-list');
  if (!taskList) return;
  
  const filteredTasks = tasks.filter(task => {
    if (taskFilter === 'completed') return task.completed;
    if (taskFilter === 'pending') return !task.completed;
    return true;
  });

  taskList.innerHTML = filteredTasks.map((task) => `
    <li class="${task.completed ? 'completed' : ''}" onclick="toggleTask(${task.id})">
      <span style="flex:1;">${task.text}</span>
      <span style="font-size:0.8rem;opacity:0.7;padding:2px 8px;border-radius:4px;background:var(--${task.priority === 'high' ? 'error' : task.priority === 'medium' ? 'warning' : 'success'});">${task.priority}</span>
      <button onclick="deleteTask(${task.id}); event.stopPropagation();" style="padding:4px 8px;font-size:0.8rem;background:var(--error);">Delete</button>
    </li>
  `).join('');

  updateTaskStats();
}

function updateTaskStats() {
  const total = tasks.length;
  const completed = tasks.filter(t => t.completed).length;
  const pending = total - completed;
  
  const statsEl = document.getElementById('task-stats');
  if (statsEl) {
    statsEl.textContent = `Total: ${total} • Completed: ${completed} • Pending: ${pending}`;
  }
}

// Utility Functions
function showToast(message, type = 'success') {
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.textContent = message;
  document.body.appendChild(toast);
  
  setTimeout(() => toast.classList.add('show'), 100);
  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => {
      if (document.body.contains(toast)) {
        document.body.removeChild(toast);
      }
    }, 300);
  }, 3000);
}

function showNotesStatus(message, type) {
  const notesStatus = document.getElementById('notes-status');
  if (notesStatus) {
    notesStatus.textContent = message;
    notesStatus.className = `status ${type}`;
    notesStatus.style.display = 'block';
    setTimeout(() => notesStatus.style.display = 'none', 2000);
  }
}

function updateLastSave() {
  const lastSaveEl = document.getElementById('last-save');
  if (lastSaveEl) {
    lastSaveEl.textContent = `Saved ${new Date().toLocaleTimeString()}`;
  }
}

// Make functions global for onclick handlers
window.toggleTask = toggleTask;
window.deleteTask = deleteTask;
window.copyColor = copyColor;

// Add ripple effect to buttons
document.addEventListener('click', (e) => {
  if (e.target.tagName === 'BUTTON' && !e.target.disabled) {
    createRipple(e.target, e);
  }
});

function createRipple(element, event) {
  const rect = element.getBoundingClientRect();
  const size = Math.max(rect.width, rect.height);
  const x = event.clientX - rect.left - size / 2;
  const y = event.clientY - rect.top - size / 2;
  
  const ripple = document.createElement('span');
  ripple.className = 'ripple';
  ripple.style.width = ripple.style.height = size + 'px';
  ripple.style.left = x + 'px';
  ripple.style.top = y + 'px';
  
  element.appendChild(ripple);
  setTimeout(() => {
    if (element.contains(ripple)) {
      element.removeChild(ripple);
    }
  }, 600);
}

// Command palette functionality
document.addEventListener('keydown', (e) => {
  if (e.ctrlKey && e.key === 'k') {
    e.preventDefault();
    toggleCommandPalette();
  } else if (e.key === 'Escape') {
    hideCommandPalette();
  }
});

function toggleCommandPalette() {
  const palette = document.getElementById('command-palette');
  const overlay = document.getElementById('overlay');
  
  if (palette.classList.contains('active')) {
    hideCommandPalette();
  } else {
    palette.classList.add('active');
    overlay.style.opacity = '1';
    overlay.style.visibility = 'visible';
    document.getElementById('command-input').focus();
  }
}

function hideCommandPalette() {
  const palette = document.getElementById('command-palette');
  const overlay = document.getElementById('overlay');
  
  palette.classList.remove('active');
  overlay.style.opacity = '0';
  overlay.style.visibility = 'hidden';
}

// FAB menu
const fabMain = document.getElementById('fab-main');
const fabMenu = document.getElementById('fab-menu');
let fabMenuOpen = false;

if (fabMain) {
  fabMain.onclick = () => {
    fabMenuOpen = !fabMenuOpen;
    if (fabMenuOpen) {
      fabMenu.style.opacity = '1';
      fabMenu.style.visibility = 'visible';
    } else {
      fabMenu.style.opacity = '0';
      fabMenu.style.visibility = 'hidden';
    }
  };
}

// Theme switching
document.querySelectorAll('.theme-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    showToast(`${btn.dataset.theme} theme activated!`);
  });
});

console.log('Mason Tool script loaded successfully!');
</script>

</body>
</html>
